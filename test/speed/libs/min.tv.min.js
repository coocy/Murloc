var ENABLE_DEBUG=!0,ENABLE_IE_SUPPORT=!0
String.prototype.hasOwnProperty("trim")||(String.prototype.trim=function(){return this.replace(/^(\s|\r|\n|\r\n)*|(\s|\r|\n|\r\n)*$/g,"")}),Function.prototype.hasOwnProperty("bind")||(Function.prototype.bind=function(e){var t=this,a=arguments.length>1?Array.slice(arguments,1):null
return function(){return t.apply(e||this,a)}})
var DOC=document,WIN=window,IsTouch="ontouchstart"in WIN,UA=WIN.navigator.userAgent,IsAndroid=/Android|HTC/i.test(UA)||!!(WIN.navigator.platform+"").match(/Linux/i),IsIPad=!IsAndroid&&/iPad/i.test(UA),IsIPhone=!IsAndroid&&/iPod|iPhone/i.test(UA),IsIOS=IsIPad||IsIPhone,IsWindowsPhone=/Windows Phone/i.test(UA),IsBlackBerry=/BB10|BlackBerry/i.test(UA),IsIEMobile=/IEMobile/i.test(UA),IsIE=!!DOC.all,IsWeixin=!(!WIN.WeixinJSBridge&&!/MicroMessenger/i.test(UA)),PixelRatio=parseFloat(WIN.devicePixelRatio)||1,MAX_TOUCHMOVE_DISTANCE_FOR_CLICK=IsAndroid?10:6,START_EVENT=IsTouch?"touchstart":"mousedown",MOVE_EVENT=IsTouch?"touchmove":"mousemove",END_EVENT=IsTouch?"touchend":"mouseup",_hasGetElementsByClassName=DOC.getElementsByClassName,ScreenSizeCorrect=1
if(ENABLE_IE_SUPPORT&&IsIE)try{DOC.execCommand("BackgroundImageCache",!1,!0)}catch(e){}IsAndroid&&(WIN.screen.width/WIN.innerWidth).toFixed(2)==PixelRatio.toFixed(2)&&(ScreenSizeCorrect=1/PixelRatio)
var RR={uid:1,$:function(e,t){return arguments.length<1?RR.fnCache||new RR.fn:new RR.dom(e,t)},fn:function(){return RR.fnCache=this,this},fnCache:null,selectorAll:DOC.querySelectorAll?function(e,t){t=t||DOC
for(var a,i=e.slice(1),o=!0,n=["+","~","[",">","#","."," "],r=n.length;r--;)if(-1!=i.indexOf(n[r])){o=!1
break}return o?"#"==e.charAt(0)?(a=DOC.getElementById(i))?[a]:[]:_hasGetElementsByClassName&&"."==e.charAt(0)?t.getElementsByClassName(i):t.getElementsByTagName(e):t.querySelectorAll(e)}:function(){return[]},dom:function(e,t){if(this.context=[],e)if(e.nodeType||e===WIN)this.context=[e],this.length=1
else if("string"==typeof e){var a=e.length
if("<"===e.charAt(0)&&a>2&&">"===e.charAt(a-1)){e=e.replace(/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,"<$1></$2>")
var i=DOC.createElement("div")
i.innerHTML=e
for(var o=0,n=i.childNodes.length;n>o;o++)this.context.push(i.childNodes[o])}else{if(t instanceof RR.dom&&(t=t.context[0],!t))return this.context=[],this.length=0,this
this.context=RR.selectorAll(e,t)}this.length=this.context.length}else{if(e instanceof RR.dom)return e
e.length&&(this.context=function(e){for(var t=[],a=0,i=e.length;i>a;a++)t.push(e[a])
return t}(e),this.length=this.context.length)}else this.length=0
return this}}
RR.dom.prototype={each:function(e){for(var t,a=0,i=this.length;i>a;a++)t=this.context[a],e.call(this,t,a)
return this}},RR.fn.prototype={extend:function(e,t){var a,i
for(var a in t)i=t[a],null!==i&&(e[a]="object"!=typeof i||i.nodeType||i instanceof Array?i:RR.fn.prototype.extend({},i))
return e},copy:function(e){if(e instanceof Array){for(var t=[],a=0,i=e.length;i>a;a++)t[a]=RR.fn.prototype.copy(e[a])
return t}return"object"==typeof e?RR.fn.prototype.extend({},e):e}}
var $=RR.$,JSON=WIN.JSON||{$specialChars:{"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},$replaceChars:function(e){return JSON.$specialChars[e]||"\\u00"+Math.floor(e.charCodeAt()/16).toString(16)+(e.charCodeAt()%16).toString(16)},stringify:function(e){switch(type=e instanceof Array?"array":typeof e){case"string":return'"'+e.replace(/[\x00-\x1f\\"]/g,JSON.$replaceChars)+'"'
case"array":for(var t=[],a=0,i=e.length;i>a;a++)t.push(JSON.stringify(e[a]))
return"["+t.join(",")+"]"
case"object":case"hash":var o,n,t=[]
for(o in e){n=e[o]
var r=JSON.stringify(n)
r&&t.push(JSON.stringify(o)+":"+r)}return"{"+t.join(",")+"}"
case"number":case"boolean":return e+""
case!1:return"null"}return null},parse:function(string){return eval("("+string+")")}},Storage=function(e,t){var a=Storage.getStorage()
if(a){if(void 0===t)return t=a.getItem(e),t&&JSON.parse(t)
a.setItem(e,JSON.stringify(t))}}
Storage.getStorage=function(){var e
try{e=WIN.localStorage}catch(t){ENABLE_DEBUG&&alert("localStorage is not supported")}return Storage.getStorage=function(){return WIN.localStorage},e},Storage.clear=function(e){var t=Storage.getStorage()
if(t)if(e)for(var a in t)0===a.indexOf(e)&&t.removeItem(a)
else t.clear()}
var Notification={reg:function(e,t){Notification._notificationData.hasOwnProperty(e)?Notification._notificationData[e].push(t):Notification._notificationData[e]=[t]},fire:function(e,t,a){a=a||WIN,!t||t instanceof Array||(t=[t])
var i,o=Notification._notificationData[e]||[],n=o.length
for(i=0;n>i;i++)o[i].apply(a,t)},_notificationData:{}},URL={getQueryData:function(e){e=e.replace(/^\?+/,"").replace(/&amp;/,"&")
for(var t,a=e.split("&"),i=a.length,o={};i--;)if(t=a[i].split("="),t[0]){var n=t[1]||""
try{n=decodeURIComponent(n)}catch(r){n=unescape(n)}o[decodeURIComponent(t[0])]=n}return o},getQueryString:function(e,t){var a,i=t?URL.getElSearchString(t):WIN.location.search.substring(1)
return a=URL.getQueryData(i),e in a?a[e]:null},getElSearchString:function(e){var e=$(e).get(0),t=e.search||""
if(!t){var a="FORM"==e.nodeName?e.getAttribute("action"):e.getAttribute("href"),i=a.indexOf("?");-1!==i&&(t=a.slice(i))}return t},setQueryString:function(e,t){var a,i,e=$(e),o=e.get(0),n=o.search,r=n||""
if(!n){var s,l=o.nodeName
if("FORM"==l){if("post"!=o.method.toLowerCase()){for(a in t){i=t[a]
var c=$('input[name="'+a+'"]',e)
c?c.val(i):e.append($('<input type="hidden" name="'+a+'" value="'+i+'" />'))}return}s=e.attr("action")||location+""}else s=e.attr("href")||location+""
var d=s.indexOf("?"),p=s.indexOf("#");-1==p&&(p=s.length),0>d||d>p?(r="",d=p):r=s.slice(d+1,p)}var u=URL.getQueryData(r),h=[]
for(a in t)u[a]=t[a]
for(a in u)i=u[a],h.push(a+(i?"="+encodeURIComponent(i):""))
if(!(h.length<1)){var m="?"+h.join("&")
if(n)o.search=m
else{var v="FORM"==l?"action":"href"
e.attr(v,s.slice(0,d)+m+s.slice(p))}}},objToQueryString:function(e){var t,a,i,o=[]
for(t in e)if(a=e[t],a instanceof Array)for(i=a.length;i--;)o.push(t+"[]="+encodeURIComponent(a[i]))
else o.push(t+"="+encodeURIComponent(void 0===a?"":a))
return o.join("&")}}
RR.fn.prototype.param=function(e){return URL.objToQueryString(e)},RR.fn.prototype.getUrlParam=function(e,t){return URL.getQueryString(e,t)}
var Cookie={isEnabled:!1,set:function(e,t,a,i){var o=""
if(0!==a){var n=new Date
n.setTime(n.getTime()+36e5*(a||24)),o=";expires="+n.toGMTString()}var r=escape(e)+"="+escape(t)+o+";path=/"+(i?";domain="+i:"")
DOC.cookie=r},get:function(e){for(var t,a=DOC.cookie.split(";"),i=0;i<a.length;i++)if(t=a[i].split("="),t[0].trim()==e)return unescape(t[1])
return null},remove:function(e){Cookie.set(e,"",-1e3)},test:function(){var e="_c_t_"
Cookie.set(e,"1"),Cookie.isEnabled="1"===Cookie.get(e),Cookie.remove(e)}}
RR.fn.prototype.ready=RR.dom.prototype.ready=function(e){return!0===RR.loader.isLoaded?e():(RR.loader.callbacks.push(e),RR.loader.init()),this},RR.dom.prototype.remove=function(){return this.each(function(e){e.parentNode.removeChild(e)})},RR.insertNodeBefore=function(e,t,a){var i=a?"insertBefore":"appendChild"
if(e.nodeType)t[i](e,a)
else if(e instanceof RR.dom)for(var o=0,n=e.length;n>o;o++)t[i](e.context[o],a)
else if("string"==typeof e){var r=DOC.createElement("div")
r.innerHTML=e
for(var o=0,n=r.childNodes.length;n>o;o++)t[i](r.childNodes[0],a)}},RR.dom.prototype.before=function(e){return this.each(function(t){RR.insertNodeBefore(e,t.parentNode,t)})},RR.dom.prototype.after=function(e){return this.each(function(t){RR.insertNodeBefore(e,t.parentNode,t.nextSibling)})},RR.dom.prototype.prepend=function(e){return this.each(function(t){RR.insertNodeBefore(e,t,t.firstChild)})},RR.dom.prototype.append=function(e){return this.each(function(t){RR.insertNodeBefore(e,t)})},RR.dom.prototype.insertBefore=function(e){return $(e).before(this),this},RR.dom.prototype.insertAfter=function(e){return $(e).after(this),this},RR.dom.prototype.prependTo=function(e){return $(e).prepend(this),this},RR.dom.prototype.appendTo=function(e){return $(e).append(this),this},RR.dom.prototype.width=function(){var e=this.context[0]
return e&&e.offsetWidth},RR.dom.prototype.height=function(){var e=this.context[0]
return e&&e.offsetHeight},RR.dom.prototype.offset=function(){var e=this.context[0]
if(e){var t=e.getBoundingClientRect,a=t&&t(),i=DOC.body
if(a)return{left:a.left+(WIN.pageXOffset||i.scrollTop||0),top:a.top+(WIN.pageYOffset||i.scrollLeft||0)}}return{left:0,top:0}},RR.dom.prototype.first=function(){return this.eq(0)},RR.dom.prototype.last=function(){return this.eq(-1)},RR.dom.prototype.eq=function(e){return $(this.get(e))},RR.dom.prototype.indexOf=[].indexOf,RR.dom.prototype.index=function(){return this.parent().children().context.indexOf(this.get(0))},RR.dom.prototype.get=function(e){var t=this.length,a=e+(0>e?t:0)
return a>t-1?null:this.context[a]},RR.dom.prototype.parent=function(){var e=new RR.dom,t=[]
return this.each(function(e){t.push(e.parentNode)}),e.context=t,e.length=t.length,e},RR.dom.prototype.children=function(){var e=new RR.dom,t=[]
return this.each(function(e){for(var a=0,i=e.childNodes.length;i>a;a++){var o=e.childNodes[a]
1==o.nodeType&&t.push(o)}}),e.context=t,e.length=t.length,e},RR.dom.prototype.clone=function(e){var t=new RR.dom,a=[]
return this.each(function(t){a.push(t.cloneNode(!!e))}),t.context=a,t.length=a.length,t},RR.dom.uid=function(e){return e.__ruid||(e.__ruid=RR.uid++)},RR.loader={callbacks:[],isInited:!1,isLoaded:!1,timer:null,ieTimer:function(){IsIE&&"interactive"==DOC.readyState?(RR.loader.timer&&clearTimeout(RR.loader.timer),RR.loader.timer=setTimeout(RR.loader.ieTimer,10)):(RR.loader.init(),RR.loader.isInited=!0)},init:function(){if(!1===RR.loader.isInited){var e=DOC.readyState
if("loading|uninitialized".indexOf(e)<0){if(IsIE&&"interactive"==e)return RR.loader.ieTimer(),void 0
RR.loader.loaded()}else if(RR.loader.isInited=!0,DOC.addEventListener)DOC.addEventListener("DOMContentLoaded",RR.loader.loaded)
else{var t="_ir_",a=DOC.getElementById(t)
a||(DOC.write('<script id="'+t+'" defer="true" src="://"></script>'),a=DOC.getElementById(t)),a.onreadystatechange=a.onload=function(){"complete"==this.readyState&&RR.loader.loaded()}}}},loaded:function(){!1===RR.loader.isLoaded&&(RR.loader.isLoaded=!0,RR.loader.fire())},fire:function(){for(var e=RR.loader.callbacks,t=0,a=e.length;a>t;t++)if(ENABLE_DEBUG)e[t]()
else try{e[t]()}catch(i){}RR.loader.callbacks=[]}},RR.dom.prototype.offset=function(){var e=this.context[0],t={left:0,top:0}
if(e)do t.left+=e.offsetLeft||0,t.top+=e.offsetTop||0,e=e.offsetParent
while(e)
return t},RR.dom.prototype.html=function(){var e=arguments[0]
if(void 0!==e){e+=""
var t=!0
return e.indexOf("<")>-1&&e.indexOf(">")>-1&&(t=!1),this.each(function(a){a&&"innerHTML"in a&&(a.innerHTML=e,t||Notification.fire("DOM.html",a))})}var a=this.context[0]
return a&&a.innerHTML},RR.dom.prototype.val=function(){var e=arguments[0]
if(void 0!==e)return this.each(function(t){t.value=e})
var t=this.context[0]
return t&&t.value},RR.dom.prototype.attr=function(e,t){if(void 0!==t)return this.each(function(a){a.setAttribute(e,t)})
var a=this.context[0]
return a&&a.getAttribute&&a.getAttribute(e)},RR.dom.prototype.removeAttr=function(e){return this.each(function(t){t.removeAttribute&&t.removeAttribute(e)})},RR.dom.prototype.css=function(e,t){return this.each(function(a){if("object"!=typeof e){var i={}
i[e]=t,e=i}for(var o in e){var n=e[o]
"opacity"===o||""===n||isNaN(n)||0==n||(n+="px"),a.style[o]=n}})},RR.dom.prototype.hasClass=function(e){for(var t,a=(e||"").match(/\S+/g)||[],i=a.length,o=0,n=this.length;n>o;o++)for(t=0;i>t;t++)if((" "+this.context[o].className+" ").indexOf(" "+a[t]+" ")>-1)return!0
return!1},RR.dom.prototype.addClass=function(e){var t=(e||"").match(/\S+/g)||[],a=t.length
return this.each(function(e){var i,o,n=" "+(e.className||"")+" "
for(o=0;a>o;o++)i=t[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ")
e.className=n.trim()})},RR.dom.prototype.removeClass=function(e){var t=(e||"").match(/\S+/g)||[],a=t.length
return this.each(function(e){var i,o,n=" "+e.className+" ",r=n
for(o=0;a>o;o++)i=t[o],n.indexOf(i)>-1&&(n=n.replace(" "+i+" "," "))
r!=n&&(e.className=n.trim())})},RR.dom.prototype.toggleClass=function(e,t){var a=(e||"").match(/\S+/g)||[],i=a.length
return this.each(function(e){var o,n,r,s=" "+e.className+" "
for(r=0;i>r;r++){o=a[r]
var n=s.indexOf(" "+o+" ")<0
void 0===t&&(t=n),t?n&&(s+=o+" "):s=s.replace(" "+o+" "," ")}e.className=s.trim()})},RR.dom.prototype.serialize=function(e){var t={},a=function(e,a){var i=t[e]
void 0===i?t[e]=a:i instanceof Array?i.push(a):t[e]=[i,a]}
return this.each(function(e){var i=e.nodeName
if("FORM"==i)$().extend(t,$(e.elements).serialize(!0))
else{var o,n,r=e.name
if(r&&/INPUT|SELECT|BUTTON|TEXTAREA/i.test(i))if(o=(e.type+"").toUpperCase(),r=r.replace(/\[\]$/,""),n=e.value,"SELECT"===i){var s,l=e.selectedIndex
l>=0&&(s=e.options[l],a(r,s.value))}else"RADIO"===o||"CHECKBOX"===o?e.checked&&a(r,n):a(r,n)}}),e?t:$().param(t)},RR.dom.prototype.check=function(){var e=!0
return this.each(function(t){if("FORM"==t.nodeName){for(var a,i=t.elements,o=0,n=i.length;n>o;o++){var r=i[o],s=r.getAttribute("required"),l=r.value.trim(),c=r.getAttribute("label")||r.getAttribute("placeholder")||r.name
if(""===l){if(null!==s){a=s||"请填写"+c,IsAndroid||r.focus()
break}}else{var d=r.getAttribute("length")
if(d){var p=l.length,u=d.split(","),h=parseInt(u[0]||0,10),m=parseInt(u[1]||0,10)
h>p?a=c+"的长度至少"+h+"个字符":m&&p>m&&(a=c+"的长度不能超过"+m+"个字符")}}}a&&($(t).showFormTip(a,"error"),e=!1)}}),e},RR.dom.prototype.showFormTip=function(e,t){return this.each(function(a){var i=$(".form_tip",a)
i.length<1&&(i=$('<div class="form_tip"></p>').prependTo(a)),i.attr("class","form_tip "+t).html(e)})}
var UseTouchClick=!1
!IsAndroid&&UA.indexOf("PlayStation")<0&&(UseTouchClick=!0),RR.event=function(e){if(e instanceof RR.event)return e
var t=e.changedTouches,a=t&&t.length>0?t[0]:e
return this.event=e,this.originalEvent=a,this.target=e.target||e.srcElement,this.type=e.type,this},RR.event.prototype={isPropagationStopped:!1,preventDefault:function(){var e=this.event
e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){var e=this.event
this.isPropagationStopped=!0,e.stopPropagation&&e.stopPropagation()}},RR.eventCache={},RR.eventType={delegated:"|click|mouseover|mouseout|mousemove|focus|blur|touchstart|touchmove|touchend|touchcancel",captured:"|focus|blur|"},RR.addEvent=DOC.addEventListener?function(e,t,a,i){t.addEventListener(e,a,i)}:function(e,t,a){t.attachEvent("on"+e,a)},RR._addEventData=function(e,t,a,i){var o=RR.eventCache[e]||(RR.eventCache[e]={}),n=o[t]||(o[t]=[]),r=-1!==RR.eventType.captured.indexOf(e)
n.length<1&&(-1!==RR.eventType.delegated.indexOf(e)&&(a=DOC),RR.addEvent(e,a,RR.dispatchEvent,r)),n.push(i)},RR.addTagEvent=function(e,t,a){var i="t"+t.toUpperCase()
RR._addEventData(e,i,DOC,a)},RR.dispatchEvent=function(e){var e=new RR.event(e),t=e.type,a=e.target,i=RR.eventCache[t]||{}
if("click"===t&&UseTouchClick&&!e.originalEvent.isSimulated)return e.preventDefault(),void 0
for(;a;){var o=RR.dom.uid(a),n=i[o]||[],r=!0,s=i["t"+a.nodeName]
s&&(n=n.concat(s))
for(var l=0,c=n.length;c>l;l++){e.currentTarget=a
var d=n[l].apply(a,[e])
!1===d&&(r=d)}if(!1===r&&(e.preventDefault(),e.stopPropagation()),!0===e.isPropagationStopped)break
a=a.parentNode}},RR.dom.prototype.on=function(e,t){if("object"==typeof e){for(var a in e)this.on(a,e[a])
return this}return this.each(function(a){var i=RR.dom.uid(a)
RR._addEventData(e,i,a,t)})},RR.dom.prototype.trigger=function(e,t){var a=DOC.createEvent("MouseEvents")
return a.initEvent(e,!0,!0),a.data=t,a.isSimulated=!0,this.each(function(t){"function"==typeof t[e]?t[e]():t.dispatchEvent&&t.dispatchEvent(a)})},RR.touchEvent={activeCls:"active",hasTouchStart:!1,initedId:"__RR_EVENT_INITED__",init:function(){if(!WIN[RR.touchEvent.initedId]){var e,t={onTouchStart:START_EVENT,onTouchMove:MOVE_EVENT,onTouchEnd:END_EVENT}
for(e in t)RR.addEvent(t[e],DOC,RR.touchEvent[e],!1)
RR.addEvent("touchcancel",DOC,RR.touchEvent.onTouchCancel,!1),UseTouchClick&&RR.addEvent("click",DOC,RR.dispatchEvent,!1),WIN[RR.touchEvent.initedId]=!0}},onTouchStart:function(e){var e=new RR.event(e),t=e.originalEvent,a=e.target,i=RR.eventCache.click||{}
for(RR.touchEvent.clearHighlight(),RR.touchEvent.hasTouchStart=!0,RR.touchEvent.elTarget=a,RR.touchEvent.startPoint=[t.screenX*ScreenSizeCorrect,t.screenY*ScreenSizeCorrect],RR.touchEvent.targets=[];a;){var o=RR.dom.uid(a),n=i[o];(n||["A","INPUT","BUTTON"].indexOf(a.nodeName)>-1)&&RR.touchEvent.targets.push(RR.$(a).addClass(RR.touchEvent.activeCls)),a=a.parentNode}},onTouchMove:function(e){var t=RR.touchEvent
if(t.hasTouchStart){var e=new RR.event(e),a=e.originalEvent,i=Math.pow(Math.pow(a.screenX*ScreenSizeCorrect-t.startPoint[0],2)+Math.pow(a.screenY*ScreenSizeCorrect-t.startPoint[1],2),.5)
i>MAX_TOUCHMOVE_DISTANCE_FOR_CLICK&&t.onTouchCancel()}},onTouchEnd:function(){if(RR.touchEvent.hasTouchStart){var e=DOC.createEvent("MouseEvents"),t=RR.touchEvent.elTarget
RR.touchEvent.onTouchCancel(),UseTouchClick&&(e.initEvent("click",!0,!0),e.isSimulated=!0,t.dispatchEvent(e))}},onTouchCancel:function(){RR.touchEvent.hasTouchStart=!1,RR.touchEvent.elTarget=null,setTimeout(RR.touchEvent.clearHighlight,200)},clearHighlight:function(){var e=RR.touchEvent.targets,t=RR.touchEvent.activeCls
if(e){for(var a=0,i=e.length;i>a;a++)e[a].removeClass(t)
RR.touchEvent.targets=null}}},RR.touchEvent.init()
var blankFn=function(){},ajaxObj=function(e,t){return this.ajax(e,t)}
ajaxObj.prototype={isLoading:!1,ajax:function(e,t){var a={}
return"string"==typeof e?a.url=e:"object"==typeof e?t=e:e="",t=t||{},a.beforeSend=t.beforeSend||blankFn,a.dataFilter=t.dataFilter||blankFn,a.done=t.done||t.success||blankFn,a.fail=t.fail||t.error||blankFn,a.always=t.always||t.complete||blankFn,a.cache=!!t.cache,a.dataType=(t.dataType||"json").toLowerCase(),a.data=t.data||{},a.timeout=t.timeout||0,a.type=(t.type||"GET").toUpperCase(),this.options=a,this},get:function(e){return this.options.type="GET",e&&(this.options.url=e),this.send()},post:function(e){return this.options.type="POST",e&&(this.options.url=e),this.send()},abort:function(){return this.isLoading&&(this.xmlhttp&&this.xmlhttp.abort(),this.isLoading=!1),this},send:function(){var e=this.xmlhttp||(WIN.XMLHttpRequest?new XMLHttpRequest:!1)
if(!e)return this._onFail("error"),this
this.abort(),this.xmlhttp=e,this.isLoaded=!1
var t=this,a=this.options,i=function(){if(t&&!0!==t.isLoaded&&1!=t.timoutFired){var i=e.responseText
t.responseText=i,e.onreadystatechange=blankFn,t.isLoading=!1,i?"json"==a.dataType?i&&(responseData=t._getJSON(i))?(t.responseData=responseData,t._onLoad(responseData,e.status)):t._onFail("parsererror"):t._onLoad(i,e.status):t._onFail("parsererror"),t.isLoaded=!0,t=null}}
if(e.onerror=function(){t.isLoading=!1,t._onFail("offline")},e.onload=i,e.onreadystatechange=function(){t._resetTimeout(),4===this.readyState&&0!==this.status&&i()},!1!==a.beforeSend(this,a)){var o=a.data,n="string"==typeof o?o:$().param(o),r=a.url
if("GET"==a.type){var s=""
n.length>0&&(s=-1<r.indexOf("?")?"&":"?"),e.open("get",r+s+n,!0)}else e.open("post",r,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded")
e.setRequestHeader("Accept","*/*"),this.timoutFired=!1,e.send(n),this.isLoading=!0}return this},_getJSON:function(responseText){if(""!==responseText)try{return JSON.parse(responseText)}catch(e){ENABLE_DEBUG&&console.log("JSON.parse failed!")
try{return eval("("+responseText+")")}catch(e){console.log("JSON.parse(eval) failed!")}}return null},_resetTimeout:function(){var e=this.options
if(e.timeout){this.timer&&(clearTimeout(this.timer),this.timer=null)
var t=this
this.timer=setTimeout(function(){!0!==t.timoutFired&&!0!==t.isLoaded&&(t.abort(),t.timoutFired=!0,t._onFail("timeout"))}.bind({timer:this.timer}),1e3*e.timeout)}},_onLoad:function(e,t){this.options.done.apply(this,[e,t,this]),this.options.always.apply(this,[this,"success"])},_onFail:function(e){this.options.fail.apply(this,[this,e]),this.options.always.apply(this,[this,e])}},RR.fn.prototype.ajax=function(e,t){return new ajaxObj(e,t).send()},RR.fn.prototype.get=function(e,t){return new ajaxObj(e,t).get()},RR.fn.prototype.post=function(e,t){return new ajaxObj(e,t).post()}
var Console={inited:!1,init:function(){Console.inited=!0,Console.el=$('<div style="-webkit-overflow-scrolling:touch;pointer-events:none;overflow:auto;line-height:1.5;z-index:5000;position:fixed;left:0;top:0;max-width:50%;max-width:100%;font-size:11px;background:rgba(0,0,0,.8);color:#fff;"></div>').appendTo(DOC.body)},log:function(){!1===Console.inited&&Console.init()
for(var e,t=[],a=0,i=arguments.length;i>a;a++)e=arguments[a],e="function"==typeof e?""+e:JSON.stringify(arguments[a]),t.push(e)
Console.el.prepend('<p style="margin-top:-1px;padding:.5em;border-top:1px solid rgba(255,255,255,.3)">'+t.join(" ")+"</p>")}},API_KEY="695fe827ffeb7d74260a813025970bd5",API_URL="/api/",API_PARAMS={api_key:API_KEY,plat:"17",sver:"1.0",partner:"1"},APP_VER={android:{version:"3.5",tip:"手势操作，更佳观影体验"},ios:{version:"3.5",tip:"手势操作，更佳观影体验"}},IS_EXTERNAL_PLAYER=!1
location.href.match(/player=1/i)&&(IS_EXTERNAL_PLAYER=!0)
var IsUC=!1;(UA.match(/ UC(Browser)?/i)||UA.match(/compatible;Android/i))&&(UA.match(/ LT15i /i)||(IsUC=!0))
var IsQQBrowser=UA.match(/MQQBrowser/i),h5Src;(h5Src=URL.getQueryString("src"))&&Cookie.set("MTV_SRC",h5Src,86400,".m.tv.sohu.com")
var WebRoot=""
"m.s.sohu.com"==location.host&&(WebRoot="http://m.tv.sohu.com")
var SetListVersion="20131229",Util={pingback:function(e){for(var t=e.split("|"),a=0,i=t.length;i>a;a++)(new Image).src=t[a]},getOSVersion:function(){var e=0
if(IsIOS){var t=UA.match(/os ([0-9_]+)/i)
t&&t[1]&&(e=Util.getVersionNumber(t[1]))}return e},getVersionNumber:function(e){var t=e.replace(/_/g,".").replace(/^([0-9]+\.[0-9]+)[0-9\.]*/,"$1")
return parseFloat(t||0)},timeFromNow:function(e){var t=60,a=60*t,i=24*a,o=30*i,n=12*o
return e=(+new Date-parseInt(e))/1e3,e>=n?Math.floor(e/n)+"年前":e>=o?Math.floor(e/o)+"个月前":e>=i?Math.floor(e/i)+"天前":e>=a?Math.floor(e/a)+"小时前":e>=t?Math.floor(e/t)+"分钟前":"刚刚"},getTotalMonth:function(e){var t=new Date(e)
return 12*t.getFullYear()+t.getMonth()},secondsToTime:function(e){var t=parseInt(e)
isNaN(t)&&(t=0)
var a=Math.floor(t/60),e=t%60
if(10>e&&(e="0"+e),60>a)return 10>a&&(a="0"+a),a+":"+e
var i=Math.floor(a/60)
return a%=60,10>a&&(a="0"+a),10>i&&(i="0"+i),i+":"+a+":"+e},secondsToTimeText:function(e){var t=parseInt(e)
isNaN(t)&&(t=0)
var a=Math.floor(t/60),e=t%60+"秒"
if(60>a)return(a>0?a+"分":"")+e
var i=Math.floor(a/60)
return a%=60,(i>0?i+"小时":"")+a+"分"+e},shortCount:function(e){return e=parseInt(e),e>1e8?e=Math.floor(e/1e8)+"亿":e>1e4&&(e=Math.floor(e/1e4)+"万"),e},dateString:function(e){var t
return(t=e.match(/([0-9]{4}\-[0-9]+\-[0-9]+)/))&&(e=t[1]),e},setLoad:function(e){var e=$(e)
return e.hasClass("_load_inited")||e.addClass("_load_inited").append($('<i class="ui_loading"><u></u><u></u><u></u></i>')),e},loadScript:function(e,t,a){var i=DOC.getElementsByTagName("head")[0]||DOC.body,o=DOC.createElement("script"),n=!1
o.src=e,o.onload=o.onreadystatechange=function(){n||this.readyState&&"loading"===this.readyState||(n=!0,t&&t.apply(null,a||[]),o.onload=o.onreadystatechange=null,i.removeChild(o))},i.appendChild(o)},formatURL:function(e){return(e+"").replace(/^https?:\/\/(my\.|v\.)?tv\./i,"http://m.tv.").replace("http://s.","http://m.s.").replace("http://m.s.","http://m.tv.").replace(/^http:\/\/(video\.)?2012/i,"http://m.s")},getPageOffset:function(){return WIN.pageYOffset||DOC.body&&DOC.body.scrollTop||0},getDownloadAppLink:function(e){var t,a="http://m.tv.sohu.com/app"
return IsIPhone?1==URL.getQueryString("isappinstalled")?(a="sohuvideo://",(t=WIN.VideoData)&&(a+="action.cmd?action=1.1&vid="+t.vid+"&cid="+t.cid+"&sid="+t.sid+"&cateCode="+t.cateCode)):a="https://itunes.apple.com/cn/app/sou-hu-shi-pin-gao-qing/id458587755?mt=8":IsIPad?a="https://itunes.apple.com/cn/app/sou-hu-shi-pin-hd/id414430589?mt=8":IsAndroid?(a=e||"http://upgrade.m.tv.sohu.com/channels/hdv/680/3.5/SohuTV_3.5_680_201311261820.apk",IS_EXTERNAL_PLAYER&&DOC.referrer.match(/m\.sohu\.com/i)&&(a="http://mfiles.sohu.com/mfiles/SohuTV_3.5_862_201312171236.apk")):IsWindowsPhone&&(a="http://www.windowsphone.com/zh-CN/apps/403faf93-d22c-4331-ac32-9560ee9fac94"),a},appLink:function(){var e=$(this)
return ClickTrace.pingback(e),setTimeout(function(){location.href=e.attr("href")||Util.getDownloadAppLink()},50),!1},getConnectionType:function(){var e,t=navigator.connection,a=""
return t&&(e=t.type,e==t.CELL_2G?a="2g":e==t.CELL_3G?a="3g":e==t.WIFI&&(a="wifi")),a},_isMeizu:!1,isMeizu:function(){var e=!1
if(IsAndroid)if(IsUC||IsQQBrowser||!UA.match(/(M9|M032) Build/i)){if(UA.match(/Mac OS X/i)&&!IsUC){var t=WIN.screen.width,a=WIN.screen.height;(640==t||960==t||320==t&&410==a||410==t&&320==a)&&(e=!0)}}else e=!0
return Util._isMeizu=e,Util.isMeizu=function(){return Util._isMeizu},e},fixVideoMask:function(){IsAndroid&&(IsUC||IsQQBrowser)&&(SohuMobilePlayer.pause(),WIN.scrollTo(0,Util.getPageOffset()+1))},getDownloadURL:function(e){return e}}
URL.updateGlobalParms=function(e,t){for(var a,i,o=$("a[href],form",e),n=o.length,t=t||URL.URLGlobalParms;n--;)a=o.get(n),i=a.href,i&&i.match(/^(sms|tel|mail)/i)||URL.setQueryString(a,t)},URL.init=function(){var e,t=["clientType","clientVer","actionVer","plat","startClient","useVideoLink","r","player","f"],a=URL.getQueryData(location.search.substring(1)),i={},o=0
IS_EXTERNAL_PLAYER&&t.push("channeled")
for(var n=t.length;n--;)e=t[n],a.hasOwnProperty(e)&&(i[e]=a[e],o++)
URL.URLGlobalParms=i,o>0&&(URL.updateGlobalParms(DOC,i),Notification.reg("DOM.html",URL.updateGlobalParms))},$().ready(URL.init)
var EncodeUtil={utf8to16:function(e){var t,a,i,o,n,r,s,l,c
for(t=[],o=e.length,a=i=0;o>a;){switch(n=e.charCodeAt(a++),n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t[i++]=e.charAt(a-1)
break
case 12:case 13:r=e.charCodeAt(a++),t[i++]=String.fromCharCode((31&n)<<6|63&r)
break
case 14:r=e.charCodeAt(a++),s=e.charCodeAt(a++),t[i++]=String.fromCharCode((15&n)<<12|(63&r)<<6|63&s)
break
case 15:switch(15&n){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r=e.charCodeAt(a++),s=e.charCodeAt(a++),l=e.charCodeAt(a++),c=(7&n)<<18|(63&r)<<12|(63&s)<<6|(63&l)-65536,t[i]=c>=0&&1048575>=c?String.fromCharCode(c>>>10&1023|55296,1023&c|56320):"?"
break
case 8:case 9:case 10:case 11:a+=4,t[i]="?"
break
case 12:case 13:a+=5,t[i]="?"}}i++}return t.join("")},b64_decodex:function(e){var t,a,i=[],o=""
for(t=0,a=e.length;a>t;t+=4)o+=EncodeUtil.b64_423(e.substr(t,4))
for(t=0,a=o.length;a>t;t+=8)i+=EncodeUtil.b2i(o.substr(t,8))
return i},b64_423:function(e){for(var t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","-","_"],a=0,i=e.length,o="";i>a;a++){for(var n=0;64>n;n++)if(e.charAt(a)==t[n]){var r=n.toString(2)
o+=("000000"+r).substr(r.length)
break}if(64==n)return 2==a?o.substr(0,8):o.substr(0,16)}return o},b2i:function(e){for(var t=0,a=128,i=0;8>i;i++,a/=2)"1"==e.charAt(i)&&(t+=a)
return String.fromCharCode(t)}},Passport=function(){var e,t={},a=function(){var e,t,a,i=["ppinf","ppinfo","passport"]
for(e=0,t=i.length;t>e;e++)if(a=RegExp("\\b"+i[e]+"\\b=(.*?)(?:$|;)").exec(DOC.cookie),a&&a.length){a=a[1]
break}return a},i=function(e){var t=""
try{e=unescape(e).split("|"),("1"==e[0]||"2"==e[0])&&(t=EncodeUtil.utf8to16(EncodeUtil.b64_decodex(e[3])))}catch(a){}return t},o=function(e){var t,a,i,o={}
for(e=(e||"").split("|"),t=0,a=e.length;a>t;t++)i=e[t].split(":"),i.length>1&&(o[i[0]]=i[2])
return o},n=function(){var n=a(),r=t
return e!=n&&(e=n,r=o(i(n)),t=r),r}
return{getPassport:function(){return n().userid||""},getUid:function(){return n().uid||""},getUUID:function(){return n().uuid||""},getQname:function(){return n().uniqname||""}}}(),Trace=function(){var e=WIN.screen,t=Math.floor(e.width*ScreenSizeCorrect)+"x"+Math.floor(e.height*ScreenSizeCorrect),a=Passport.getPassport(),i="",o=""
return IsIOS?(o="ios",IsIPad?i="ipad":IsIPhone&&(i="iphone")):IsAndroid?i=o="android":IsWindowsPhone&&(i=o="windowsphone"),{getUid:function(){return Cookie.get("SUV")||""},getScreenSize:function(){return t},getPassport:function(){return a},getOS:function(){return o},getPlatform:function(){return i},getVideoData:function(e){var t=WIN.VideoData||{}
return t[e]||""},getConnectionType:function(){return Util.getConnectionType()}}}(),ClickTrace={pingback:function(e,t,a){var t=t||e.attr("position")||"",a=a||e&&e.attr("details")||"",i={t:+new Date,uid:Trace.getUid(),position:t,op:"click",details:a,nid:Trace.getVideoData("nid"),url:location.href,refer:DOC.referrer,screen:Trace.getScreenSize(),os:Trace.getOS(),platform:Trace.getPlatform(),passport:Trace.getPassport()}
Util.pingback("http://z.m.tv.sohu.com/h5_cc.gif?"+$().param(i))}},IsHistorySupport="pushState"in history,Channel={isResfresh:!1,isSportsChannel:!1,ajaxObj:null,pageSize:15,currentPage:1,searchAlias:[],searchKeys:{},elChannelListWrap:null,elItemListWrap:null,elLoadMore:null,elItemList:null,elLoading:null,currentURL:null,channelAPI:API_URL+"search2/album.json",channelDomain:"",channeledMap:{101:"1002",106:"1003",100:"1004",115:"1005",122:"1006",112:"1007",9004:"1008",107:"1009",121:"1010",165:"1014",166:"1014",167:"1014",168:"1014"},init:function(){Channel.elChannelListWrap=$(".channel_page .channel_list_wrap"),Channel.elItemListWrap=$(".item_list_wrap"),Channel.elItemList=$(".item_list",Channel.elItemListWrap)
var e=$(".filter_handle").on("click",Channel.onFilterHandleClick)
if(e.length>0){Channel.getSearchKeys()
var t=Channel.searchAlias.join(" ")
$(".filter_handle b").html(t||"筛选"),Channel.elCategoryListWrap=$(".category_list_wrap"),Channel.elFilterButton=$(".button",Channel.elCategoryListWrap).on("click",Channel.onFilterButtonClick),$("a[search_key]").each(function(e){e.setAttribute("href","#"+e.getAttribute("href"))}).on("click",Channel.onSearchItemClick)}Channel.elChannelListWrap.length>0&&(Channel.elLoadMore=$(".more",Channel.elChannelListWrap).on("click",Channel.loadMore),IsHistorySupport&&RR.addEvent("popstate",WIN,Channel.updatePage),$(DOC.body).hasClass("sports_page")&&(Channel.channelAPI="/h5/sportscat",Channel.channelDomain="http://m.s.sohu.com",Channel.isSportsChannel=!0))},updatePage:function(){if(!(Channel.elChannelListWrap.length<1)){if(null===Channel.currentURL)return Channel.currentURL=location.href,void 0
var e=(location.pathname.match(/\/[^\/]+\/(.+)/),URL.getQueryData(location.search))
if(Channel.isSportsChannel&&!e.cat){var t=$(".row[search_name=cat] a").eq(0)
if(t.length>0){var a=t.attr("search_key").split("/")
a.length>0&&(e.cat=a[1])}}Channel.elLoading=null,Channel.currentPage=1,Channel.searchKeys=$().extend({},e),Channel.updateFilterItemsBySearchKey(),Channel.updateChannelList(!0)}},updateURL:function(){if(IsHistorySupport){var e,t,a,i=[],o=location.pathname.match(/\/[^\/\?]+/),n=o[0]
for(e in Channel.searchKeys)t=Channel.searchKeys[e],""!==t&&i.push(e+"="+Channel.searchKeys[e])
a=(location.origin||"")+n+"?"+i.join("&"),a!==location.href&&(history.pushState(null,DOC.title,a),Channel.currentURL=a)}},onFilterHandleClick:function(){var e=$(".filter_wrap"),t=Channel.elCategoryListWrap
if(e.hasClass("filter_open"))IsAndroid||t.css({webkitTransform:""}),e.removeClass("filter_open"),Channel.elFilterButton.addClass("white_button"),Channel.updateFilterItemsBySearchKey()
else{e.addClass("filter_open")
var a=t.height()+150
IsAndroid||t.css({top:-a,webkitTransform:"translate3d(0,"+a+"px,0)"})}},updateFilterItemsBySearchKey:function(){var e=$(".filter_wrap")
$("a",e).removeClass("c")
{var t=$().extend({o:"-1"},Channel.searchKeys)
$("div[search_name]",e).each(function(e){var a,i=$(e),o=i.attr("search_name")
a=o+"/"+(t[o]||""),$('a[search_key="'+a+'"]').addClass("c")})}},getSearchKeys:function(){var e={},t=[]
return $(".c[search_key]").each(function(a){var i=$(a),o=i.attr("search_key"),n=o.split("/")
e[n[0]]=n[1],""!==n[1]&&"o"!==n[0]&&t.push(i.html().replace(/<.*>/,""))}),Channel.searchAlias=t,Channel.searchKeys=$().extend({},e),e},setLoadingEl:function(e){Channel.elLoading&&Channel.elLoading.removeClass("loading"),Channel.elLoading=e},onSearchItemClick:function(){var e=$(this),t=e.hasClass("o")
return e.hasClass("c")||($(".c",e.parent()).removeClass("c"),e.addClass("c"),t||Channel.elFilterButton.removeClass("white_button")),(WIN.innerWidth>=768||t)&&(Channel.setLoadingEl(e),Channel.currentPage=1,Channel.updateChannelList()),!1},onFilterButtonClick:function(){var e=$(this)
return e.hasClass("white_button")||(Channel.setLoadingEl($(".filter_handle em")),Channel.currentPage=1,Channel.updateChannelList(),Channel.onFilterHandleClick()),!1},loadMore:function(){return Channel.setLoadingEl(Channel.elLoadMore),Channel.currentPage++,Channel.updateChannelList(),!1},updateChannelList:function(e){var t=Channel.getSearchKeys(),a={cateCode:$(DOC.body).attr("cate_code")||"",pageSize:Channel.pageSize,page:Channel.currentPage,o:"-1"}
if(Channel.isSportsChannel){var i=t.cat||"",o=[]
i&&(o=i.split("_"),o.length>0&&(i=o[0]),i.length>3&&(i=i.slice(0,3))),a.c=i,a.cateCode=i}else a.c=2
t=$().extend($().extend(a,API_PARAMS),t)
var n=Channel.channelAPI+"?"+$().param(t)
$().get(n,{beforeSend:function(){Channel.elLoading&&Util.setLoad(Channel.elLoading.addClass("loading"))},always:function(){Channel.elLoading&&Channel.elLoading.removeClass("loading")},done:Channel.updateChannelListLoaded}),e||Channel.updateURL()},updateChannelListLoaded:function(e){var e=e.data||e,t=e&&e.videos,a=t&&t.length||0,i=[],o=Channel.searchAlias.join(" "),n=$(DOC.body).attr("cate_code")
if(n){var r=Channel.channeledMap[n]
if(r)var s="12"+r+(Channel.currentPage>1?"0200":"0100")}if($(".filter_handle b").html(o||"筛选"),DOC.title=($(".channel_nav .c").html()||"")+(o?": "+o:"")+" - 搜狐视频",a>0){for(var l,c,d=0;a>d;d++)c=t[d],l=Channel.channelDomain+"/v"+c.vid+".shtml",s&&(l+="?channeled="+s),i.push("<dd>",'<a href="'+l+'" class="cover">','<b style="background-image:url('+(7!=c.cid&&c.ver_big_pic||c.video_big_pic||"")+')"></b>',"</a>","<p>",'<a href="'+l+'">'+c.tv_name+"</a>","<span>"+c.tip+"</span>","</p>","</dd>")
Channel.elChannelListWrap.removeClass("blank_list").toggleClass("has_more",e.count>Channel.currentPage*Channel.pageSize)}else Channel.elChannelListWrap.addClass("blank_list").removeClass("has_more")
i='<dl class="'+Channel.elItemList.attr("class")+'">'+i.join("")+"</dl>",1==Channel.currentPage?Channel.elItemListWrap.html(i):Channel.elItemListWrap.append('<h1 class="cate_title">第'+Channel.currentPage+"页</h1>"+i)}}
$().ready(Channel.init)
var keepSearchInputOpen=!1,Search={pageSize:15,currentPage:1,searchCount:0,hintApi:"search/hint.json",init:function(){var e=$(DOC.body),t=$("#top_search").on({blur:function(){setTimeout(function(){!1===keepSearchInputOpen&&e.removeClass("search_actived"),keepSearchInputOpen=!1},200)}})
t.val()||t.val($(".search_word").html())
var a=$(".search").on({submit:function(){var e=encodeURIComponent(t.val())
return keepSearchInputOpen=!0,""===e.trim()?(t.trigger("focus").trigger("click"),!1):(ClickTrace.pingback(null,"search_submit"),setTimeout(function(){location.href=WebRoot+"/so?wd="+e},50),void 0)},click:function(){return!IsIPhone&&!IsBlackBerry||e.hasClass("search_page")?(e.hasClass("search_actived search_page")||(e.addClass("search_actived").removeClass("history_open"),t.trigger("focus").trigger("click")),void 0):(location.href=WebRoot+"/so",!1)}})
$(".white_button",a).on("click",function(){return e.removeClass("search_actived"),!1})
var i=$(".video_src span").on("click",function(){var e=$(this)
if(!e.hasClass("c")){var t=e.parent().parent()
$(".s_l",t).removeClass("c")
var a=$(".s_l_"+e.attr("src_id"),t).addClass("c"),o=$("a",a),n=o.attr("href"),r=o.attr("target")||"_self"
$(".cover,p a",t).attr("href",n).attr("target",r),i.removeClass("c"),e.addClass("c")}})
Search.elLoadMore=$(".search_page .more").on("click",Search.loadMore.bind(WIN)),Search.searchCount=parseInt($(".search_count").html()||0,10),Search.elLoadMore.length>0?Search.bindTraceCallback($(".body_wrap")):$('<div class="mask search_mask"></div>').appendTo(e).on("click",function(){e.removeClass("history_open search_actived")}),a.length>0&&(e.hasClass("search_page")&&$(".search_album_list,.grid_list").length>0||Search.getHotSearch())},getHotSearch:function(){var e=Storage("hot")
if(e&&+new Date-e.time<108e5)Search.getHotSearchLoaded(e)
else{var t=$().extend(API_PARAMS,{n:10,plat:3}),a=API_URL+"searcher/hot.json?"+$().param(t)
$().get(a,{done:Search.getHotSearchLoaded})}},getHotSearchLoaded:function(e){var t,a=e&&e.data,i=a&&a.hotList||[],o=i.length,n=['<div class="hot_wrap">'],r=$(DOC.body)
if(o>0){var s="1211040200"
r.hasClass("search_page")&&(s="1211040100")
for(var l=0;o>l;l++)t=i[l].tv_name,n.push('<a href="/so?wd='+encodeURIComponent(t)+"&channeled="+s+'">'+t+"</a>")
e.time=+new Date,Storage("hot",e),n.push("</div>")
var c=$("nav")
c.length>0?c.after(n.join("")):$(".body_wrap").prepend(n.join("")),r.addClass("show_hot")}},bindTraceCallback:function(e){$("a",e).on("click",function(){var e=$(this)
return e.hasClass("more")||e.hasClass("item")||(ClickTrace.pingback(null,"search_click"),"_blank"===e.attr("target"))?void 0:(setTimeout(function(){location.href=e.attr("href")},50),!1)})},loadMore:function(){return Search.elLoadMore.hasClass("loading")||(Search.currentPage++,Search.updateResultList()),!1},updateResultList:function(){var e=$().extend({key:$().getUrlParam("wd")||"",pageSize:Search.pageSize,page:Search.currentPage,o:"0"},API_PARAMS),t=API_URL+"search2/keyword/video.json?"+$().param(e)
$().get(t,{beforeSend:function(){Util.setLoad(Search.elLoadMore.addClass("loading"))},always:function(){Search.elLoadMore.removeClass("loading")},done:Search.listLoaded})},listLoaded:function(e){var t=e&&e.data&&e.data.videos,a=t&&t.length||0,i=[],o=$(".search_page .channel_list_wrap"),n=$(".search_page .item_list_wrap")
if(a>0)for(var r,s,l=0;a>l;l++)s=t[l],r="/v"+s.vid+".shtml",i.push("<dd>",'<a href="'+r+'" class="cover">','<b style="background-image:url('+(s.hor_big_pic||s.video_big_pic||"")+')"></b>',"</a>","<p>",'<a href="'+r+'">'+s.tv_name+"</a>","<span>"+s.tip+"</span>","</p>","</dd>")
if(o.toggleClass("has_more",Search.searchCount>Search.currentPage*Search.pageSize),i='<dl class="item_list">'+i.join("")+"</dl>",1==Search.currentPage)n.html(i)
else{n.append('<h1 class="cate_title">第'+Search.currentPage+"页</h1>")
var c=$(i).appendTo(n)
Search.bindTraceCallback(c)}}}
$().ready(Search.init),URL.getQueryString("ht")
var Body,PlayHistory={isPanelOpen:!1,historyData:Storage("history")||[],watchLaterData:Storage("watch_later")||[],lastUpdate:0,lastCurrentTime:0,currentVideoTime:0,updatedSids:[],init:function(){Body=$(DOC.body),Notification.reg("playerOnStart",PlayHistory.insertHistoryData),Notification.reg("playerOnUnLoad",PlayHistory.insertHistoryData),Notification.reg("playerOnTimeupate",PlayHistory.insertHistoryData)
var e=$('<div class="history_wacth_later_wrap">').insertBefore($(".body_wrap")).html('<div class="watch_later_wrap"><div class="title"><span class="button white_button edit">管理</span><span class="button white_button clear">清空</span><span>稍后观看</span><div class="clear_menu"><span class="button">清空</span></div></div><div class="blank_tip">没有稍后观看</div><div class="watch_later_content"></div></div><div class="history_wrap"><div class="title"><span class="button white_button edit">管理</span><span class="button white_button clear">清空</span><span>播放记录</span><div class="clear_menu"><span class="button">清空</span></div></div><div class="blank_tip">没有播放记录</div><div class="history_content"></div></div>')
$(".clear",e).on("click",PlayHistory.showClearMenu),$(".clear_menu .button",e).on("click",PlayHistory.clearMenuClick),$(".clear_menu .button",e).on("click",PlayHistory.clearMenuClick),$(DOC).on("click",PlayHistory.closeClearMenu).on("click",PlayHistory.closeWatchLaterMenu),$(".watch_later_wrap .edit",e).on("click",function(){PlayHistory.toggleEditingState(".watch_later_wrap")}),$(".history_wrap .edit",e).on("click",function(){PlayHistory.toggleEditingState(".history_wrap")})
var t=$(".icon_history").on("click",function(){Body.toggleClass("history_open"),PlayHistory.isPanelOpen=Body.hasClass("history_open"),PlayHistory.isPanelOpen&&(Body.removeClass("search_actived"),PlayHistory.showHistoryList("watch_later"),PlayHistory.showHistoryList("history"),ClickTrace.pingback(null,"link_toptip"))})
t.length>0&&($('<div class="mask history_mask"></div>').appendTo(Body).on("click",function(){Body.removeClass("history_open search_actived"),PlayHistory.isPanelOpen=!1}),$(".num",t).length<1&&$("span",t).append('<b class="num"></b>'),PlayHistory.checkAlbumUpdate())
var a=WIN.VideoData
a&&$('<div class="watch_later_icon">稍后观看<div class="watch_later_notice_menu"><span class="tip_1">您已经记录超过10个视频了，请先观看吧</span><span class="tip_2">您已经添加过此视频了</span></div></div>').prependTo($(".appbar")).on("click",PlayHistory.addToWatchLater)},checkIsVideoAddedToWatchLater:function(e){for(var t=!1,a=PlayHistory.watchLaterData.length,i=0;a>i;i++){var o=PlayHistory.watchLaterData[i]
if(o[0]==e.sid){for(var n=0,r=o[1].length;r>n;n++)if(o[1][n][0]==e.vid){t=!0
break}break}}return t},addToWatchLater:function(){var e=WIN.VideoData
if(e){var t=e.sid,a=e.vid,i=[],o=[],n={date:+new Date,sid:t||"",vid:a,videoCount:e.videoCount||0,time:PlayHistory.lastCurrentTime||SohuMobilePlayer.currentTime()||0,title:e.tv_name||"",cover:e.video_cover||"about:blank",url:"/v"+a+".shtml"},r=$(this),s=PlayHistory.watchLaterData.length
if(r.hasClass("watch_later_menu_open"))return r.removeClass("watch_later_menu_open"),void 0
if(s>9||r.hasClass("watch_later_icon_done"))return r.addClass("watch_later_menu_open"),void 0
r.addClass("watch_later_icon_done")
for(var l=0;s>l;l++){var c=PlayHistory.watchLaterData[l]
if(c[0]==t){i=PlayHistory.watchLaterData.splice(l,1)
for(var d=0,p=c[1].length;p>d;d++)if(c[1][d][0]==a){c[1].splice(d,1)
break}o=c[1]
break}}i=[[a,n]].concat(o).slice(0,10),PlayHistory.watchLaterData=[[t,i,+new Date]].concat(PlayHistory.watchLaterData).slice(0,20),Storage("watch_later",PlayHistory.watchLaterData),ClickTrace.pingback(null,"link_mark")
var u=$('meta[property="og:image"]').attr("content"),h=$(".watch_later_flier")
h.length<1&&(h=$('<div class="watch_later_flier" style="background-image:url('+u+')"></div>').appendTo(DOC.body))
var m=r.offset().top,v=r.offset().left,f=$(".icon_history").offset().left
h.css({left:v+"px",top:m+"px",opacity:1,"-webkit-transform":"translate3d("+(f-v-25)+"px,"+(Util.getPageOffset()-m-15)+"px,0) scale(0.5)"}),setTimeout(function(){h.css("opacity",0)},400),setTimeout(function(){h.css({"-webkit-transform":"translate3d(0,0,0)",left:"-1000",top:"-1000"}),PlayHistory.updateNotificationNumber()},500)}},updateNotificationNumber:function(){$(".icon_history .num").html(PlayHistory.watchLaterData.length+PlayHistory.updatedSids.length||"")},getAlbumIdList:function(){for(var e,t=PlayHistory.historyData,a=[],i=0,o=t.length;o>i;i++){var n=t[i],r=(n[0],n[1]),s=r[0][1]
"|2|7|16|".indexOf(s.cid)>-1&&s.time>300&&(e=n[0],a.push(e))}return a},checkAlbumUpdate:function(e){var e=PlayHistory.getAlbumIdList()
if(e.length>0){var t=Storage("album_update")
t&&+new Date-t.time<36e5?PlayHistory.checkAlbumUpdateCallback(t):$().post("/api/v4/album/batch/latest.json",{data:{aids:e.join(","),api_key:API_KEY},success:PlayHistory.checkAlbumUpdateCallback})}else PlayHistory.updateNotificationNumber()},checkAlbumUpdateCallback:function(e){for(var t,a,i,e=e||{},o=e.data||[],n=0,r=o.length,s=[],l=[],c=$().copy(PlayHistory.historyData),d=c.length;r>n;n++)if(t=o[n],a=t.aid+"",l.indexOf(a)<0){for(i=0;d>i;i++){for(var p=c[i],u=p[0],h=p[1],m=0,v=h.length;v>m;m++)h[m][1].latest_video_count=t.latest_video_count
if(a==u){var f=t.show_date
if(f){f=f.replace("-","")
var g=h[0][1].date||0
if(g){var _=new Date(g),y=_.getFullYear(),C=_.getMonth(),b=_.getDate()
10>C&&(C="0"+C),10>b&&(b="0"+b)
var T=parseInt(y+""+C+b,10)
T<parseInt(f,10)&&(p[3]=1,s.push(p))}}else t.latest_video_count>parseInt(h[0][1].videoCount,10)&&(p[3]=1,s.push(p))}}l.push(a)}e.time=+new Date,Storage("album_update",e),PlayHistory.historyData=c,PlayHistory.updatedSids=s,PlayHistory.updateNotificationNumber()},insertHistoryData:function(e,t){var a=+new Date
if(!(a-PlayHistory.lastUpdate<5e3&&Math.abs(t-PlayHistory.lastCurrentTime)<5||(PlayHistory.lastUpdate=a,PlayHistory.lastCurrentTime=t,void 0!==t&&0==t||!e))){for(var i=e.sid,o=e.vid,n=[],r=[],s={date:+new Date,sid:i||"",vid:o,cid:e.cid,videoCount:e.videoCount||0,time:t||0,title:e.tv_name||"",cover:e.video_cover||"about:blank",url:"/v"+o+".shtml"},l=0,c=PlayHistory.historyData.length;c>l;l++){var d=PlayHistory.historyData[l]
if(d[0]==i){n=PlayHistory.historyData.splice(l,1)
for(var p=0,u=d[1].length;u>p;p++)if(d[1][p][0]==o){d[1].splice(p,1)
break}r=d[1]
break}}n=[[o,s]].concat(r).slice(0,40),PlayHistory.historyData=[[i,n,+new Date]].concat(PlayHistory.historyData).slice(0,50),Storage("history",PlayHistory.historyData)
for(var h=PlayHistory.watchLaterData.length,l=0;h>l;l++){var d=PlayHistory.watchLaterData[l]
if(d[0]==i){for(var p=0,u=d[1].length;u>p;p++)if(d[1][p][0]==o){d[1][p][1].time=t
break}break}}Storage("watch_later",PlayHistory.watchLaterData)}},showHistoryList:function(e){e||(e="history")
var t=Storage(e)||[]
"watch_later"===e&&(t=t.concat(PlayHistory.updatedSids))
for(var a,i,o,n,r,s,l,c,d,p,u=[],h=0,m=t.length,v=null,f=new Date,g=f.getFullYear()+"-"+f.getMonth();m>h;h++){i=t[h][0],o=t[h][1],r=new Date(t[h][2]),s=r.getDate(),l=r.getMonth(),c=r.getFullYear(),s==f.getDate()&&g==c+"-"+l?s="今天":(s=l+"-"+s,c!==f.getFullYear()&&(s=c+"-"+s)),"history"===e&&v!==s&&u.push("<time>"+s+"</time>"),u.push('<dl class="item_list'+(1===t[h][3]?" updated":"")+'">')
var _=""
_="watch_later"===e?1===t[h][3]?"1211050002":"1211050001":"1211050003"
for(var y=0,C=o.length;C>y;y++){n=o[y][1],d=n.time||0,p=n.vid,d=d>60?"已播放: "+Util.secondsToTimeText(d):"播放不到1分钟",a="/v"+p+".shtml?channeled="+_,u.push("<dd>",'<a sid="'+i+'" vid="'+p+'" channeled="'+_+'" href="'+a+'" class="cover">','<b style="background-image:url('+(n.cover||"about:blank")+')"></b>',"</a>","<p>",'<a sid="'+i+'" vid="'+p+'" channeled="'+_+'" href="'+a+'">'+n.title+"</a>","<span>"+d+"</span>","</p>",'<span class="remove"><b></b></span>',"</dd> ")
break}u.push("</dl>"),v=s}var b=$("."+e+"_content").html(u.join(""))
$("a",b).on("click",function(e){var t=$(e.currentTarget),a=t.attr("sid")
PlayHistory.removeViewLaterItem(a),PlayHistory.removeUpdateNotificationItem(a)}),$(".remove",b).on("click",PlayHistory.deleteItem),$("."+e+"_wrap").toggleClass("blank_list",1>h)},removeViewLaterItem:function(e){for(var t=PlayHistory.watchLaterData,a=[],i=WIN.VideoData||{},o=0,n=t.length;n>o;o++){var r=t[o]
r[0]!=e&&a.push(r)}i.sid==e&&$(".watch_later_icon_done").removeClass("watch_later_icon_done"),PlayHistory.watchLaterData=a,Storage("watch_later",a),PlayHistory.updateNotificationNumber()},removeUpdateNotificationItem:function(e){for(var e,t=$().copy(PlayHistory.historyData),a=0,i=t.length;i>a;a++){var o=t[a],n=o[0],r=o[1]
if(n==e)for(var s=0,l=r.length;l>s;s++){var c=r[s][1].latest_video_count
c&&(r[s][1].videoCount=c)}}var d=PlayHistory.updatedSids,p=d.length
for(a=0;p>a;a++){var o=d[a],n=o[0]
if(n==e){d.splice(a,1)
break}}PlayHistory.historyData=t,Storage("history",PlayHistory.historyData)},deleteItem:function(){var e=$(this),t=e.parent().parent(),a=t.parent(),i=$("a",t).attr("sid")
$("dd",t).css({"-webkit-transform":"translate3d(-"+(t.width()+98)+"px,0,0)","-webkit-transition":"-webkit-transform 200ms linear 0"}).on("webkitTransitionEnd",function(){if(t.remove(),a.hasClass("history_content")){for(var e=0,o=PlayHistory.historyData.length;o>e;e++)if(PlayHistory.historyData[e][0]==i){PlayHistory.historyData.splice(e,1)
break}Storage("history",PlayHistory.historyData),PlayHistory.historyData.length<1&&(a.parent().addClass("blank_list"),PlayHistory.toggleEditingState(".history_wrap"))}else t.hasClass("updated")?PlayHistory.removeUpdateNotificationItem(i):PlayHistory.removeViewLaterItem(i),$("dl",a).length<1&&(PlayHistory.toggleEditingState(".watch_later_wrap"),a.parent().addClass("blank_list")),PlayHistory.updateNotificationNumber()})},toggleEditingState:function(e,t){var a=$(e),i=$(".edit",a)
a.hasClass("editing")||t?(a.removeClass("editing"),i.html("管理").addClass("white_button")):(i.html("完成").removeClass("white_button"),a.addClass("editing").removeClass("clear_menu_open"))},showClearMenu:function(){var e=$(this),t=e.parent().parent(),a=t.hasClass("clear_menu_open")
$(".watch_later_wrap").removeClass("clear_menu_open"),$(".history_wrap").removeClass("clear_menu_open"),t.toggleClass("clear_menu_open",!a),PlayHistory.toggleEditingState(".watch_later_wrap",!0),PlayHistory.toggleEditingState(".history_wrap",!0)},clearMenuClick:function(){var e=$(this),t=e.parent().parent().parent()
if(t.addClass("blank_list").removeClass("clear_menu_open"),t.hasClass("watch_later_wrap")){Storage.clear("watch_later"),PlayHistory.watchLaterData=[],$(".watch_later_icon_done").removeClass("watch_later_icon_done")
var a=$().copy(PlayHistory.updatedSids),o=a.length
for(i=0;o>i;i++){var n=a[i],r=n[0]
PlayHistory.removeUpdateNotificationItem(r)}PlayHistory.updateNotificationNumber()}else t.hasClass("history_wrap")&&(Storage.clear("history"),PlayHistory.historyData=[])},closeClearMenu:function(e,t){for(var a=e&&e.target;!t&&DOC!==a&&DOC.body!==a;){if($(a).hasClass("clear_menu clear edit"))return
a=a.parentNode}$(".watch_later_wrap").removeClass("clear_menu_open"),$(".history_wrap").removeClass("clear_menu_open")},closeWatchLaterMenu:function(e,t){for(var a=e&&e.target;!t&&DOC!==a&&DOC.body!==a;){if($(a).hasClass("watch_later_icon"))return
a=a.parentNode}$(".watch_later_icon").removeClass("watch_later_menu_open")}}
$().ready(PlayHistory.init)
var IS_EXTERNAL_PLAYER,cookieSUV=Cookie.get("SUV"),cookieIPLOC=Cookie.get("IPLOC")
if(!cookieSUV||!cookieIPLOC){var _suv=1e3*+new Date+Math.round(1e3*Math.random())
cookieSUV||Cookie.set("SUV",_suv,5e4,".sohu.com"),cookieIPLOC||Util.loadScript("//pv.sohu.com/suv/"+_suv)}var HDPV={getLandrefer:function(){var e=Cookie.get("landingrefer")||"",t=DOC.referrer||""
return e||(t=t.split("?")[0],t=t.split("#")[0],t&&t.indexOf("tv.sohu.com")<0&&(e=t,Cookie.set("landingrefer",e,0,".tv.sohu.com"))),e},sendData:function(){var e=top.location==self.location?"t":"f",t="",a=Cookie.get("SUV")||Cookie.get("fuid")||""
try{t="f"==e?encodeURIComponent(top.location.href):""}catch(i){}var o=WIN.VideoData||{},n="?url="+encodeURIComponent(location.href)+"&refer="+encodeURIComponent(DOC.referrer)+"&fuid="+a+"&yyid="+(Cookie.get("YYID")||"")+"&showqd="+(Cookie.get("showqd")||"")+"&vid="+(o.vid||"")+"&nid=&trans="+($("input.trans").val()||"")+"&pid="+(o.plid||"")+"&suv="+a+"&istoploc="+e+"&topurl="+t+"&lb=0&lf="+encodeURIComponent(HDPV.getLandrefer())+"&passport="+Passport.getPassport()+"&_="+ +new Date+"&islogin="+(DOC.cookie.indexOf("ppinf=")<0&&DOC.cookie.indexOf("ppinfo=")<0&&DOC.cookie.indexOf("passport=")<0?"f":"t")+"&catename=&cateid="+(o.cid||"")+"&playlistid="+(o.plid||"")
Util.pingback("http://z.m.tv.sohu.com/pvpb.gif"+n),Util.pingback("http://pv.hd.sohu.com/pvpb.gif"+n),Util.pingback("http://zz.m.sohu.com/video_pv.gif?v=3&ref="+escape(DOC.referrer||"-")+"&ct="+ +new Date+"&_smuid="+(Cookie.get("_smuid")||"-"))}}
$().ready(HDPV.sendData),$().ready(function(){var e={}
try{e={url:location.href,refer:DOC.referrer,uid:Trace.getUid(),webtype:"",screen:Trace.getScreenSize(),catecode:Trace.getVideoData("cateCode"),pid:Trace.getVideoData("plid"),vid:Trace.getVideoData("vid"),os:Trace.getOS(),platform:Trace.getPlatform(),passport:Trace.getPassport(),t:+new Date,channeled:URL.getQueryString("channeled")||""}}catch(t){}Util.pingback("http://z.m.tv.sohu.com/pv.gif?"+$().param(e))}),IS_EXTERNAL_PLAYER||(WIN._iwt_UA="UA-sohu-123456",Util.loadScript("http://tv.sohu.com/upload/Trace/iwt-min.js"),Util.loadScript("http://js.mail.sohu.com/pv/pv_tv.1107251650.js"),Util.loadScript(("https:"==DOC.location.protocol?"https://sb":"http://b")+".scorecardresearch.com/beacon.js",function(){void 0!==WIN.COMSCORE&&WIN.COMSCORE.beacon({c1:"2",c2:"7395122",c3:"",c4:"",c5:"",c6:"",c15:""})}),"m.s.sohu.com"===location.host?$().ready(function(){Util.loadScript("http://js.sohu.com/wrating20120726.js",function(){var e
try{e=WIN._getAcc()}catch(t){}e&&Util.loadScript("http://sohu.wrating.com/a1.js",function(){WIN.vjAcc=e,WIN.wrUrl="http://sohu.wrating.com/"
try{if(!0===WIN.vjValidateTrack()){var t=WIN.wrUrl+"a.gif"+WIN.vjGetTrackImgUrl()
$(DOC.body).append('<div style="display:none"><img src="'+t+'" id="wrTagImage" /></div>'),WIN.vjSurveyCheck()}}catch(a){}})})}):Util.loadScript("http://tv.sohu.com/upload/Trace/wrating.js"))
var VideoTrace={t:+new Date,playId:+new Date,inited:!1,init:function(){var e=44,t=WIN.VideoData,a=""
IsIPad?(e=4,a="1h5"):IsIPhone?(e=41,a="3h5"):IsAndroid?(e=42,a="6h5"):IsWindowsPhone?(e=43,a="11h5"):IsIEMobile&&(e=43),VideoTrace.qcPlat=a,VideoTrace.platType=e,VideoTrace.qfDomain=(Math.random()>.5?"qf1":"qf2")+".hd.sohu.com.cn",VideoTrace.qcURL=null!==URL.getQueryString("r")&&t?"http://sptjs1.hd.sohu.com.cn/h5/tttst.html":"http://qc.hd.sohu.com.cn/caton/video/",VideoTrace.inited=!0},qcPingback:function(e){if(!1===VideoTrace.inited&&VideoTrace.init(),"1h5"!=VideoTrace.qcPlat){var t="",a="",i=WIN.VideoData,o=WIN.VideoData.video_src||""
IsIOS?t=1:IsAndroid?t=2:IsWindowsPhone&&(t=3),IsIPad?a="ipad":/iPod/i.test(UA)?a="ipod":IsIPhone?a="iphone":IsWindowsPhone&&(a="windowsphone")
var n=""
o.match(/\.m3u8/i)?n="m3u8":o.match(/\.mp4/i)&&(n="mp4"),e+="&uid="+(Cookie.get("SUV")||"")+"&poid=&plat="+VideoTrace.qcPlat+"&sver=&os="+t+"&sysver="+Util.getOSVersion()+"&net="+Trace.getConnectionType()+"&playmode=&vid="+(i.vid||"")+"&sid="+(i.sid||"")+"&vtype="+n+"&pn="+a+"&duFile="+encodeURIComponent(o)+"&version="+(WIN.VideoData.videoVersion||0)+"&isp2p=0&ltype=0&time="+ +new Date,Util.pingback(VideoTrace.qcURL+"?"+e)}},qfPingback:function(e){!1===VideoTrace.inited&&VideoTrace.init()
var t=WIN.VideoData
e+="&seekto=0&pt="+VideoTrace.platType+"&sid="+(Cookie.get("SUV")||"")+"&vid="+(t.vid||"")+"&nid=&ref="+encodeURIComponent(location.href)+"&dom=&t="+VideoTrace.t++,Util.pingback("http://"+VideoTrace.qfDomain+"/dov.do?method=stat"+e)},DMPingback:function(e){var t=Cookie.get("SUV")||"",a=WIN.VideoData
e+="&sid="+t+"&uid="+t+"&ua=h5&vid="+(a.vid||"")+"&nid=&pid="+(a.plid||"")+"&catcode="+(a.cateCode||"")+"&url="+encodeURIComponent(location.href)+"&refer="+encodeURIComponent(DOC.referrer)+"&isHD=0&isp2p=0&type=vrs&systype=0&cateid="+a.cid+"&apikey="+API_KEY+"&trans="+($("input.trans").val()||"")+"&_smuid="+(Cookie.get("_smuid")||"-")+"&userid=&t="+VideoTrace.t++,Util.pingback("http://z.m.tv.sohu.com/"+e+"&channeled="+(URL.getQueryString("channeled")||"")),e+="&pvid=",URL.getQueryString("pvid")||"",Util.pingback("http://pb.hd.sohu.com.cn/"+e)},DMPingbackNew:function(e,t){e=$().extend({url:location.href,refer:DOC.referrer,uid:Trace.getUid(),webtype:Trace.getConnectionType(),screen:Trace.getScreenSize(),catecode:Trace.getVideoData("cateCode"),pid:Trace.getVideoData("plid"),vid:Trace.getVideoData("vid"),cateid:Trace.getVideoData("cid"),ltype:Trace.getVideoData("ltype"),company:Trace.getVideoData("company"),version:"0",type:"9001"==Trace.getVideoData("cid")?"my":"vrs",td:Trace.getVideoData("duration"),apikey:API_KEY,t:+new Date,os:Trace.getOS(),platform:Trace.getPlatform(),passport:Trace.getPassport(),channeled:URL.getQueryString("channeled")||"",playid:VideoTrace.playId},e),Util.pingback((t||"http://z.m.tv.sohu.com/vv.gif")+"?"+$().param(e))},vv:function(){var e=WIN.VideoData
VideoTrace.qfPingback("&error=0&code=2&allno=0&vvmark=1&totTime="+e.duration),Util.pingback("http://b.scorecardresearch.com/b?c1=1&c2=7395122&c3=&c4=&c5=&c6=&c11="+(Cookie.get("SUV")||"")),VideoTrace.DMPingback("hdpb.gif?msg=playCount&cts=isow&time=0&ltype="+(e.ltype||0)+"&company="+(e.company||"")+"&td="+e.duration),VideoTrace.playId=+new Date,VideoTrace.DMPingbackNew({msg:"playCount",time:"0"}),VideoTrace.qcPingback("code=10&duation=0")},realVV:function(e){var t=e?(+new Date-e)/1e3:0,a=WIN.VideoData
VideoTrace.DMPingback("hdpb.gif?msg=videoStart&cts=isow&time=0&ltype="+(a.ltype||0)+"&company="+a.company+"&td="+a.duration),VideoTrace.DMPingbackNew({msg:"videoStart",time:(+new Date-VideoTrace.playId)/1e3}),VideoTrace.qcPingback("code=5&duation="+t)},start:function(){var e=WIN.VideoData
ClickTrace.pingback(null,"video_play_start",JSON.stringify({vid:e.vid})),VideoTrace.qcPingback("code=15")},heart:function(e){VideoTrace.DMPingback("stats.gif?tc="+e),VideoTrace.DMPingbackNew({tc:e},"http://z.m.tv.sohu.com/playtime.gif")},ended:function(e,t){VideoTrace.DMPingback("hdpb.gif?msg=videoEnds&tc="+e),VideoTrace.DMPingbackNew({msg:"videoEnds",time:e}),VideoTrace.qcPingback("code=7&duration="+e+"&ct="+t)},abort:function(){},error:function(e){VideoTrace.qfPingback("&error=500&code=2&allno=1&vvmark=0"),VideoTrace.qcPingback("code=8&duation="+(+new Date-e)/1e3+"&error="+(WIN.VideoData.video_src?"1000":"401"))},buffer:function(e,t){var a=(+new Date-t)/1e3;(1==e||4==e)&&VideoTrace.qfPingback("&code=5&bufno=1&allbufno="+e),VideoTrace.qcPingback("code="+(1==e?6:4)+"&ct="+e+"&duation="+a),null!==URL.getQueryString("r")&&1==e&&void 0!==RateTest&&RateTest.startTest("auto")}},AdData,PlayerAd={init:function(){var e=WIN.VideoData||{},t=ENABLE_DEBUG?"http://60.28.168.195/h?":"http://m.aty.sohu.com/h?"
AdURL=t+("plat=h1&sysver="+Util.getOSVersion()+"&pn=ipad&pt=oad&cat="+(e.cmsId||"1")+"&al="+(e.plid||"")+"&vid="+(e.vid||"")+"&tvid="+(e.tvid||"")+"&c="+(e.channelId||"")+"&du="+(e.duration||0)+"&ar="+(e.areaId||"")+"&vc="+(e.cateCode||"")+"&json=std&tuv="+(Cookie.get("TUV")||"")+"&callback=PlayerAdLoaded&pageUrl="+escape(location.href)+"&_t="+ +new Date),Util.loadScript(AdURL),WIN.PlayerAdLoaded=PlayerAd.AdLoaded},AdLoaded:function(e){var t=e&&e.data&&e.data.oad&&e.data.oad[0]
t&&(t[3]&&Util.pingback(t[3]),t[0]&&(AdData={src:t[0],time:t[1],url:t[2],load:t[3],end:t[5],click:t[6]},Notification.fire("playerAdLoaded",AdData)))}}
IsIPad&&PlayerAd.init()
var MainPlayer,Player=function(e){var t,a,i=$(e),o=!1,n=!1,r=!(IsAndroid||IsIOS||IsWindowsPhone||IsIEMobile||IsBlackBerry),s=!1,l=IsIPad||!IsIPhone,c=!1,d=function(){if(!URL.getQueryString("clientType")){var e=$(".player_message")
e.length<1&&$('<a class="player_message" position="appdownload_inplayer"><span class="button">下载</span>如果视频无法正常播放，<br />请点击下载搜狐视频客户端</a>').on("click",Util.appLink).insertAfter(i)}}
if((a=UA.match(/MQQBrowser(?:\/([0-9\._]+))?/i))&&(a=Util.getVersionNumber(a[1]),4.3>a&&(s=!0)),IsAndroid){var p=navigator.appVersion||""
p.match(/UC\/8\.7/i)&&(s=!0),UA.match(/LT26w.+ MQQBrowser/i)&&(s=!0)}if(!(i.length<1)){var u=function(){var e,a
if(IsIE)e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),e&&(a=parseInt(e.GetVariable("$version").split(" ")[1].split(",")[0],10))
else{var o=WIN.navigator.plugins
if(o&&o.length>0&&(e=o["Shockwave Flash"]))for(var n=e.description.split(" "),r=0,s=n.length;s>r;r++){var l=parseInt(n[r],10)
isNaN(l)||(a=l)}}return a?(Util.loadScript("http://js.tv.itc.cn/base/plugin/swfobject13072501.js",function(){if("9001"==t.cid)var e=new SWFObject("http://share.vrs.sohu.com/my/v.swf&showRecommend=0&autoplay=true&sogouBtn=0&shareBtn=0&topBarFull=0&topBar=0&topBarNor=0&skinNum=8&topBarFull=0&id="+t.vid+"&api_key="+API_KEY,"sohuplayer","100%","100%","9,0,115","#000000")
else{var a="http://tv.sohu.com/upload/swf/20131104/Main.swf",e=new SWFObject(a,"sohuplayer","100%","100%","9,0,115","#000000")
e.addVariable("skinNum","1"),e.addVariable("pageurl",location.href),e.addVariable("vid",t.vid),e.addVariable("pid",t.pid),e.addVariable("nid",""),e.addVariable("seekTo","0"),e.addVariable("jump","0"),e.addVariable("autoplay","true"),e.addVariable("showRecommend","0"),e.addVariable("sid",Cookie.get("SUV")||""),e.addVariable("api_key",API_KEY)}e.addParam("allowscriptaccess","always"),e.addParam("allowfullscreen","true"),e.flashVars=""
var o=e.getFlashHtml()
i.addClass("flash_player"),$(".video",i).html(o)}),!0):!1},h=URL.getQueryData(location.search.substring(1))
1==h.startClient?o=IsAndroid:1==h.useVideoLink&&(s=!0)
var m=" poster ",v=[]
UA.match(/ HTC Desire S /i)?o=!0:Util.isMeizu()&&(s=!0),UA.match(/MI\-ONE/i)&&(l=!1,v.push("hide_fullscreen")),UA.match(/MI\-ONE|GT\-I9100/i)&&!UA.match(/MI\-ONE Plus/i)&&v.push("hide_init_video"),IsUC&&UA.match(/HS\-U950/i)&&v.push("auto_height"),(IS_EXTERNAL_PLAYER||UA.match(/HTC S720/i))&&v.push("hide_fullscreen"),IsUC&&(m+=" controls "),IsAndroid&&UA.match(/Mac OS X/i)&&!UA.match(/ UC(Browser)?/i)&&(Util.isMeizu()?s=!0:(d(),c=!0,v.push("show_slider_bar"))),v.length>0&&i.addClass(v.join(" ")),UA.match(/MI\-ONE Plus/i)&&(Util.getOSVersion()>=4?n=!0:nt=!1),n&&$(DOC.body).addClass("cover_mask_play")
var f,g=$(".video",i).append("<video"+m+"></video>"),_=$("video",g),y=_.get(0),C=$(".poster",i),b=$(".duration",i),T=$(".current_time",i),w=$(".trackbar",i),S=$(".played",i),R=$(".buffered",i),k=$(".button_play",i),P=$(".player_controls",i),I=$(".fullscreen",i),L=$(".video_quality",i),D=!1,U=[],E=!0,N=!1,A=!1,O=$('<div class="ad_timer"></div>').appendTo(i),V=function(){if(!0===N)return f.src
var e,a,i=0,o=t.urls
if(U=[],D){if(e=Util.getDownloadURL(o.downloadUrl)||o.mp4,e instanceof Array)for(var n=0,r=e.length;r>n;n++)if(e[n]){e=e[n]
break}e&&(e=(e+"").split(",")[0]),U.push(e)}else{a=o.m3u8
for(var n=0,r=a.length;r>n;n++)if(a[n]){U.push(a[n])
break}if(U.length>2&&(IsIPad||WIN.screen.width>768)&&U.shift(),U.length>=2){var s=Storage("quality")
"hq"===s?(L.removeClass("video_quality_fast").addClass("video_quality_hq"),e=U[1],i=21):(L.addClass("video_quality_fast").removeClass("video_quality_hq"),e=U[0],i=1)}else e=U[0]}return L.css("display",U.length>=2?"block":"none"),WIN.VideoData.video_src=e,WIN.VideoData.videoVersion=i,e},M=function(){E=!1}
IsIOS&&Util.getOSVersion()>=4.2&&(D=!1),(IsAndroid||IsWindowsPhone||UA.match(/BB10|BlackBerry/i))&&(D=!0),o&&(D=!1)
var B=URL.getQueryString("f")
B&&(D=!("m3u8"===B)),Notification.reg("playerAdLoaded",function(e){Z||(f=e,N=!0,y.src=V(),y.play())})
var x,W,H,F,j=!1,q=!1,X=0,z=0,Q=0,Y=!1,G=!1,K=!1,J=!1,Z=!1,et=!1,tt=0,at=0,it=0,ot=0,nt=!0,rt=function(){var e=(setTimeout(function(){VideoTrace.realVV(+new Date)},250),"sohuvideo://vid="+t.vid+"&sid="+t.plid+"&m3u8="+encodeURIComponent(V())+"&title="+encodeURIComponent($(".video_detail h3").html()))
return h.clientType||1==h.startClient?(location.href=e,void 0):($("#play_in_app").length<1&&$('<iframe id="play_in_app" frameborder="0" name="play_in_app" width="0" height="0"></iframe>').on("load",d).appendTo(DOC.body),$('<form action="'+e+'" target="play_in_app"></form>').appendTo(DOC.body).trigger("submit"),void 0)},st=function(e){if(o)return rt()
if(IS_EXTERNAL_PLAYER&&(y.volume=.08),IsAndroid&&UA.match(/HS\-U950|HUAWEI_C8812|vivo/i)&&!IsUC&&!IsQQBrowser){y.play()
try{y.webkitEnterFullscreen&&y.webkitEnterFullscreen(),y.mozRequestFullScreen&&y.mozRequestFullScreen()}catch(e){}}y.play(),e&&e.stopPropagation()},lt=function(){y.pause()},ct=function(e){if(!P.hasClass("hidden")&&!1!==E){if(!0===y.paused&&!Y||!l)st(e)
else{if(N)return
y.pause()}e.stopPropagation()}},dt=function(e){i.hasClass("inline_player")&&(y.play(),y.webkitEnterFullscreen&&y.webkitEnterFullscreen(),y.mozRequestFullScreen&&y.mozRequestFullScreen(),setTimeout(function(){y.play()},0),e.stopPropagation())},pt=function(e){U.length<2||(X=y.currentTime,X>3&&(X-=3),q=!0,at=-1,L.hasClass("video_quality_fast")?(L.removeClass("video_quality_fast").addClass("video_quality_hq"),y.src=U[1],Storage("quality","hq")):(L.addClass("video_quality_fast").removeClass("video_quality_hq"),y.src=U[0],Storage("quality","fast")),yt(),e.stopPropagation())},ut=function(){H&&(clearTimeout(H),H=null)},ht=function(e){return o?rt():!1===E?(VideoTrace.realVV(+new Date),setTimeout(function(){window.top.location.href=WIN.VideoData.video_src},50),!1):N?(et?(Util.pingback(f.click),y.pause(),WIN.open(f.url)):st(e),void 0):(l?(P.hasClass("hidden")?P.removeClass("hidden"):!0===et&&P.addClass("hidden"),clearTimeout(x),x=setTimeout(function(){!0===et&&P.addClass("hidden")},3500),!1===et&&st(e)):st(e),void 0)},mt=function(){clearTimeout(x),!1===y.paused?(i.hasClass("player_init")&&(i.removeClass("player_init"),IS_EXTERNAL_PLAYER&&VideoTrace.vv(),VideoTrace.start(),Notification.fire("playerOnStart",t)),Notification.fire("playerOnPlay",t),(!IsAndroid||l)&&P.addClass("loading"),l&&C.addClass("hidden"),N&&i.addClass("player_ad"),et=!0,Z=!0,Y=!0,G=!0,ot=+new Date):vt()},vt=function(){et=Y=!1,P.removeClass("hidden loading"),l||C.removeClass("hidden"),k.removeClass("button_pause"),i.addClass("player_pause"),W&&(clearTimeout(W),W=null),Notification.fire("playerOnPause",t)},ft=function(e,a){return 1==et&&vt(),S.css("width",0),Z=!1,j=!1,G=!1,Q=0,T.html(Util.secondsToTime(0)),N?(N=!1,Util.pingback(f.end),i.removeClass("player_ad"),y.src=V(),setTimeout(function(){y.play(),kt()},0),void 0):(at>0&&at>=y.duration-15&&(a||(VideoTrace.ended(y.currentTime,z),Notification.fire("playerOnEnd",t))),at=0,z=0,setTimeout(function(){i.addClass("player_init"),C.removeClass("hidden"),P.removeClass("hidden")
try{y.currentTime=0}catch(e){}},10),F&&(clearInterval(F),F=null),void 0)},gt=function(){j=!0,!1===c&&(l=IsIPad||!IsIPhone&&(y.webkitSupportsFullscreen||y.mozRequestFullScreen||y.requestFullScreen),i.toggleClass("inline_player",l)),IS_EXTERNAL_PLAYER&&(!IsAndroid||IsUC||IsQQBrowser||l&&nt&&(ClickTrace.pingback(null,"video_play_autostart_external"),st()))},_t=function(){var e=y.currentTime,a=y.duration
if(e>0&&Math.abs(e-at)>2&&(ot=+new Date),at>=0&&at!==e&&(W&&(clearTimeout(W),W=null),!0===Y&&bt()),N){var i=Math.floor(a-e)
0>i&&(i=0),O.html(a>0?"广告剩余 <b>"+i+"</b> 秒":"")}IsIOS&&0==e&&et||(!Y&&!Et&&a>0&&(Rt(),T.html(Util.secondsToTime(e)),S.css("width",e/a*100+"%"),b.html(Util.secondsToTime(a)),Notification.fire("playerOnTimeupate",[t,e]),e>0&&(at=e)),kt(),ut(),!IsAndroid||UA.match(/( UC(Browser)?|QQBrowser)/i)||K||(H=setTimeout(function(){et&&(l?yt():lt())},1200)),K=!1)},yt=function(){if(ut(),(IsIPhone||l)&&P.addClass("loading"),Y=!0,!N){clearTimeout(x)
var e=+new Date
if(!q&&!J&&!G&&e-it>1e3){var t=(e-ot)/1e3
t>3&&VideoTrace.buffer(++z,ot)}it=e,G=!1}},Ct=function(){W||(W=setTimeout(yt,1e3)),P.removeClass("loading"),K=!0,!1===j&&gt(),!0===J&&(ot=+new Date)},bt=function(){return l&&(P.removeClass("loading"),k.addClass("button_pause"),i.removeClass("player_pause"),C.addClass("hidden")),Y=!1,N?(A||(A=!0),void 0):(l&&(x=setTimeout(function(){!0===et&&P.addClass("hidden")},3e3)),q=!1,J=!1,Notification.fire("playerOnPlaying",t),F||(F=setInterval(function(){VideoTrace.heart(y.currentTime)},12e4),VideoTrace.realVV(ot),ot=+new Date),void 0)},Tt=function(){if(!0===q&&(y.play(),X>=36||!IsIPad))try{y.currentTime=X}catch(e){}},wt=function(){N||!1!==q||VideoTrace.abort()},St=function(){if(N)return ft(),void 0
var e=this.error
if(e&&4==e.code){if(i.addClass("player_init"),C.removeClass("hidden"),P.removeClass("loading"),!D)return D=!0,y.src=V(),et&&y.play(),void 0
if(0===Q){Q++,y.src=V(),y.play()
try{y.currentTime=at}catch(t){}return}M()}},Rt=function(){var e=y.duration
tt!==e&&(b.html(Util.secondsToTime(e)),tt=e)},kt=function(){var e=y.duration,t=y.buffered,a=0,i=0
try{a=t.start(0),i=t.end(0)}catch(o){}e>0&&R.css({left:a/e*100+"%",width:(i-a)/e*100+"%"})}
if(_.on({play:mt,pause:mt,ended:ft,timeupdate:_t,progress:kt,loadedmetadata:gt,error:St,abort:wt,stalled:Tt,waiting:yt,seeking:function(){K=!0},playing:Ct}),ENABLE_DEBUG)for(var Pt=["loadstart","suspend","abort","error","stalled","play","pause","loadedmetadata","loadeddata","waiting","playing","canplay","canplaythrough","seeking","seeked","ended","ratechange","durationchange","volumechange"],It=0,Lt=Pt.length;Lt>It;It++)_.on(Pt[It],function(){})
P.on({click:ht}),k.on("click",ct),L.on("click",pt),I.on("click",dt)
var $t,Dt=$(".drag_timer",i),Ut=!1,Et=!1,Nt=0,At=[0,0],Ot=0,Vt=function(e){if(l&&Z&&!N){ut(),Et=!0
var t=e.originalEvent
At=[t.clientX,t.clientY],Ut=!0,e.stopPropagation(),Ot=S.width(),$t=w.width(),Dt.html(Util.secondsToTime(Nt)),P.addClass("dragging")}},Mt=function(e){if(!1!==Ut){var t=e.originalEvent,a=t.clientX-At[0],i=t.clientY-At[1]
if(!Et&&Math.abs(i)>Math.abs(a))return Ut=!1,void 0
e.preventDefault(),Et=!0
var o=Ot+a
0>o&&(o=0),o>$t&&(o=$t)
var n=o/$t
Nt=tt*n,Dt.html(Util.secondsToTime(Nt)),S.css("width",o+"px")}},Bt=function(){if(!1!==Et){J=!0
try{y.currentTime=Nt}catch(e){}xt()}},xt=function(){Ut=!1,Et=!1,P.removeClass("dragging")}
$(".dragbar",i).on(START_EVENT,Vt),$(DOC).on(MOVE_EVENT,Mt).on(END_EVENT,Bt).on("touchcancel",xt)
var Wt=function(){ft(null,!0),Notification.fire("playerOnUnLoad",[t,y.currentTime])}
if(RR.addEvent("unload",WIN,Wt),(UA.match(/(HS\-U950|GT\-S756|GT\-I9100|Lenovo K860|SHV-E160L|OPPOX907|MI-ONE Plus|HTC S720|ZTE U970|HUAWEI_C8812|vivo)/i)&&!IsUC||s)&&(nt=!1),IS_EXTERNAL_PLAYER){var Ht=Util.getConnectionType()
if("wifi"!==Ht)nt=!1
else{var Ft=parseInt(URL.getQueryString("player_index")||0)
Ft&&(nt=!1)}IsQQBrowser&&(nt=!1)}return this.play=function(){st()},this.pause=function(){lt()},this.duration=function(){return tt},this.currentTime=function(e){if(isNaN(e))return at
J=!0
try{y.currentTime=e}catch(t){}},this.loadVideoByData=function(e,a){if(!(t&&t.vid==e.vid||(Q=0,t&&Wt(),t=e,r&&!0===u()))){var i=V()
if(o||(y&&!s?(y.src=i,void 0!==a&&setTimeout(function(){try{y.currentTime=a}catch(e){}},0)):M()),IS_EXTERNAL_PLAYER){if(y.load(),!0===nt&&IsAndroid&&(IsUC||IsQQBrowser)){var n;(n=UA.match(/Android(?:[\/\s*]([0-9\._]+))?/i))&&(n=Util.getVersionNumber(n[1]),n>2&&(ClickTrace.pingback(null,"video_play_autostart_external"),setTimeout(st,1e3)))}}else VideoTrace.vv(),nt&&setTimeout(st,10)
Notification.fire("playerOnLoad",t)}},this}},SohuMobilePlayer={_eventMap:{ready:"playerOnLoad",play:"playerOnPlay",pause:"playerOnPause",playing:"playerOnPlaying",end:"playerOnEnd"},play:function(){MainPlayer&&MainPlayer.play()},pause:function(){MainPlayer&&MainPlayer.pause()},duration:function(){return MainPlayer?MainPlayer.duration():void 0},currentTime:function(e){return MainPlayer?MainPlayer.currentTime(e):void 0},on:function(e,t){var a=SohuMobilePlayer._eventMap[e]
a&&Notification.reg(a,t)}}
WIN.SohuMobilePlayer=SohuMobilePlayer,IS_EXTERNAL_PLAYER&&$().ready(function(){var e=$("#main_player")
if(e.length>0){var t=Util.getDownloadAppLink()
if("0"!==URL.getQueryString("toolbar")){if($(".news_toolbar").length<1){var a='<div class="share_tools news_toolbar"><a class="app_download_link" position="appdownload_external"><b></b>下载</a><a class="news_more"><b></b>更多</a></div>'
e.after(a)}}else e.addClass("no_toolbar")
$(".news_toolbar .app_download_link").attr("href",t).on("click",function(){return ClickTrace.pingback($(this)),setTimeout(function(){top.location.href=Util.getDownloadAppLink()},50),!1})
var i=$(".player_column")
$(".news_more").on("click",function(){return i.toggleClass("player_recommand").hasClass("player_recommand")&&$("video").trigger("pause"),!1}),$('<a href="#nogo">更多</a>').appendTo($(".recommand_list .cate_title")).on("click",function(){return WIN.open("http://m.tv.sohu.com/"),!1})}})
var TvSetList={currentPage:-1,currentElPage:null,nextVideo:null,videos:[],videoData:{},init:function(){Notification.reg("playerOnEnd",function(){if(!UA.match(/HS\-U950|HUAWEI_C8812/i)||IsUC||UA.match(/MQQBrowser/i)){var e,t,a,i="1211010100"
if(TvSetList.nextVideo)t=TvSetList.nextVideo.vid,e="/v"+t+".shtml",a=URL.objToQueryString(URL.URLGlobalParms),a&&(e=e+(e.indexOf("?")<0?"?":"&")+a)
else{var o=$(".vol_list .c")
if(o.length>0){var n=o.get(0).nextElementSibling
n&&(e=$("a",n).attr("href"),t=$("a",n).attr("vid"))}e||(e=$(".recommand_list dd a").attr("href"),t=$(".recommand_list dd a").attr("vid"),i="1211010300")}e&&t&&(ClickTrace.pingback(null,"video_play_next"+(IS_EXTERNAL_PLAYER?"_external":"")),setTimeout(function(){PlayerPage.loadVideo(t,i)},50))}})},loadByVideoData:function(e){if((!IS_EXTERNAL_PLAYER||"0"!==URL.getQueryString("toolbar"))&&e){var t=TvSetList.videoData,a=!0
if(e.plid==t.plid){TvSetList.videoData=t=e
var i=TvSetList.getCurrentVideoPage()
TvSetList.showPage(null,i),a=!1}else{TvSetList.videoData=t=e,TvSetList.currentPage=-1
var o=parseInt(t.videoCount||0)
if(o>0)if(ENABLE_DEBUG&&-7==t.cid){"http://api.tv.sohu.com/set/info2/"+t.plid+".json?api_key="+API_KEY+"&plat=3&sver=3.0&partner=1&callback=zongyiPageListCallback"}else $().get("/videolist",{data:{playlistid:t.plid},always:TvSetList.videoListCallback})
else $(".vol_wrap").css("display","none"),$(".vol_wrap .cate_title").removeAttr("float_menu"),FloatTitleBar.updateMenuItem()
$(".page_wrap_player").attr("class","page_wrap_player video_channel_"+t.cid||"")}if(t&&!IS_EXTERNAL_PLAYER&&!0===a){var n=Storage("set_list")
n&&SetListVersion===n.version?TvSetList.seasonListCallback(n.data):ENABLE_DEBUG?Util.loadScript("/static/scripts/tv/min.set_lists.js"):Util.loadScript("http://tv.sohu.com/upload/touch/static/scripts/tv/min.set_lists.js")}var r=$().extend({cid:t.cid,vid:t.vid,pageSize:IS_EXTERNAL_PLAYER?3:10,pageNum:1},API_PARAMS),s=API_URL+"search2/recommend.json?"+$().param(r)
$().get(s,{beforeSend:function(){$(".recommand_list").addClass("blank_list loading")},always:TvSetList.recommandListCallback})}},getCurrentVideoPage:function(){var e=TvSetList.videoData,t=TvSetList.getIsTVShow(),a=0,i=t?20:6,o=TvSetList.videos,n=o.length,r=0
for(TvSetList.nextVideo=null;n>a;a++)if(o[a].vid==e.vid){n>a+1&&(TvSetList.nextVideo=o[a+1]),r=Math.floor(a/i)
break}return r},getIsTVShow:function(){var e=TvSetList.videoData,t=e&&!!("|1000|2|16|".indexOf("|"+e.cid+"|")>-1)
return t},addVolWrapHTML:function(){if($(".vol_wrap").length<1){var e=['<div class="vol_wrap">','<div class="cate_title_wrap"><h2 class="cate_title" float_menu="vol_list" float_menu_label="&lt;span class=&quot;vol_label_tv&quot;&gt;剧集&lt;/span&gt;&lt;span class=&quot;vol_label_album&quot;&gt;专辑&lt;/span&gt;"><b class="k_vol_list" key="vol_list"><span class="vol_label_tv">剧集</span><span class="vol_label_album">专辑</span></b></h2></div>','<div class="vol_list_nav scroll_wrap" style="display:none">','<div class="vol_list_wrap scroller"></div>',"</div>",'<div class="scroll_wrap">','<dl class="item_list vol_list_result scroller"></dl>',"</div>","</div>"]
$(".appbar").after(e.join("")),Swipe.initScroller($(".vol_wrap").css("display","block"))}},videoListCallback:function(e){var t=e.responseData,a=t&&t.videos,i=TvSetList.videoData,o=i.cid,n=TvSetList.getIsTVShow(),r=n?20:6
if(a){TvSetList.videos=a
var s,l,c=parseInt(t.updateSet,10),d=Math.ceil(c/r),p=[],u=TvSetList.getCurrentVideoPage(),h=$(".vol_wrap"),m=$(".cate_title",h)
if(("1000"==o||"1"==o)&&2>c)return h.css("display","none"),m.removeAttr("float_menu"),FloatTitleBar.updateMenuItem(),void 0
if(h.css("display","block"),m.attr("float_menu","vol_list"),TvSetList.addVolWrapHTML(),$(".vol_list_nav",h).css("display",d>1?"block":"none"),d>1)for(s=0;d>s;s++)l=(s+1)*r,l>c&&(l=c),p.push('<span index="'+s+'">'+(s*r+1)+"-"+l+"</span>")
{var v=$(".vol_list_wrap").html(p.join(""))
$("span",v).on("click",TvSetList.showPage)}TvSetList.showPage(null,u,!0),FloatTitleBar.updateMenuItem()}},zongyiPageListCallback:function(e){var t=e&&e.data&&e.data.yms
if(t){var a,i,o=[]
TvSetList.addVolWrapHTML()
for(var n=t.length-1;n>=0;n--){a=0,i=t[n]
for(var r=i.ms.length-1;r>=0;r--)o.push('<span index="'+n+'" search="year='+ +i.tv_year+"&month="+((i.ms[r]+"").length<2?"0":"")+i.ms[r]+'">'+(0===a?i.tv_year+"年":"")+i.ms[r]+"月</span>"),a++}{var s=$(".vol_list_wrap").html(o.join(""))
$("span",s).on("click",TvSetList.showZongyiPage)}TvSetList.showZongyiPage(null,0)}},showZongyiPage:function(e,t){var a,i,o=TvSetList.videoData
if(void 0!==t?(i=t,a=$(".vol_list_wrap span").eq(i)):(a=$(this),i=parseInt(a.attr("index"),10)),TvSetList.currentPage!==i){var n="http://api.tv.sohu.com/search2/zongyi.json?sid="+o.plid+"&order=0&pageSize=50&api_key="+API_KEY+"&"+a.attr("search")+"&plat=3&sver=3.0&partner=1&callback=zongyiVideoListCallback"
Util.loadScript(n)}},zongyiVideoListCallback:function(e){for(var t,a,i,o=[],n=0,r=TvSetList.videoData,s=(TvSetList.getIsTVShow(),e.data.videos),l=s.length,c=r.cid;l>n;){i=s[n].map,t=2==c||16==c?n+1:i.tv_name.replace(/^《.+?》\s*/,"").replace(/^[0-9]{8}\s*/,"").trim()
var d=""
i.vid==r.vid&&(d=' class="c"'),a="/v"+i.vid+".shtml",coverPic=IS_EXTERNAL_PLAYER?"about:blank":i.video_big_pic,o.push("<dd"+d+">",'<a href="'+a+'" class="cover">','<b style="background-image:url('+coverPic+')"></b>',"</a>",'<p><a href="'+a+'"><b>第</b>'+t+"<b>集</b></a></p>","</dd>"),n++}$(".vol_list_result").html(o.join(""))},showPage:function(e,t,a){var i,o
if(void 0!==t?(o=t,i=$(".vol_list_wrap span").eq(o)):(i=$(this),o=parseInt(i.attr("index"),10)),TvSetList.currentPage!==o){TvSetList.currentElPage&&TvSetList.currentElPage.removeClass("c"),TvSetList.currentPage=o,TvSetList.currentElPage=i.addClass("c"),a&&Swipe.scrollToElement(i,null,!0)
for(var n,r,s,l,c=[],d=TvSetList.videoData,p=TvSetList.getIsTVShow(),u=p?20:6,h=o*u,m=u,v=TvSetList.videos,f=v.length,g=0,_=d.cid;m>g&&f>h;){s=v[h],l=s.vid,n=2==_||16==_?h+1:s.name.replace(/^《.+?》\s*/,"").replace(/^[0-9]{8}\s*/,"").trim()
var y=""
l==d.vid&&(y=' class="c"'),r="/v"+s.vid+".shtml?channeled=1211010100",coverPic=IS_EXTERNAL_PLAYER?"about:blank":s.largePicUrl,c.push("<dd"+y+' data-key="vid" data-type="highlight" data-value="'+l+'">','<a href="'+r+'" class="cover" vid="'+l+'" channeled="1211010100">','<b style="background-image:url('+coverPic+')"></b>',"</a>",'<p><a href="'+r+'" vid="'+l+'" channeled="1211010100"><b>第</b>'+n+"<b>集</b></a></p>","</dd>"),g++,h++}var C=$(".vol_list_result").html(c.join(""))
IsAndroid&&C.css({display:"none"}).css({display:"block"}),Swipe.scrollToElement($(".c",C))}},seasonListCallback:function(e){if(e){for(var t,a,i,o,n=0,r=e.length,s=TvSetList.videoData,l=!1;r>n;n++)for(t=e[n],i=t.length,a=0;i>a;a++)if(o=t[a],o.sid==s.plid){TvSetList.showSeasonList(t),l=!0
break}!1===l&&$(".season_list").html("")
var c={version:SetListVersion,data:e}
Storage("set_list",c)}},seasonName:"",showSeasonList:function(e){var t,a=[],i=0,o=e.length,n=TvSetList.videoData,r=e[0].season_name||e[0].name.replace(/第.+?[季部]$/,""),s=0
for(TvSetList.seasonName=r;o>i;i++)if(t=e[i].sid,t!=n.plid){var l=e[i].name
l.match(/第.+?[季部]$/)&&(l=l.replace(r,"")),a.push('<span sid="'+t+'" index="'+i+'"'+(0==s?'class="c"':"")+">"+l+"</span>"),s++}if(!(a.length<1)){var c=$(".season_list").html("<div>"+('<div class="cate_title_wrap"><h2 class="cate_title" float_menu="season_list" float_menu_label="系列"><b class="k_season_list" key="season_list">'+r+"系列</b></h2></div>")+'<div class="vol_list_nav scroll_wrap"><div class="season_list_nav scroller"></div></div><div class="scroll_wrap blank_list loading"><dl class="item_list season_list_vol_wrap scroller"></dl><div class="loading_tip">载入中...</div></div></div>')
Swipe.initScroller(c)
{var d=$(".season_list_nav",c).html(a.join(""))
$("span",d).on("click",TvSetList.showSeasonVolsList)}TvSetList.showSeasonVolsList(null,0,!0),FloatTitleBar.updateMenuItem()}},showSeasonVolsList:function(e,t){var a,i
if(void 0!==t)i=t,a=$(".season_list_nav span").eq(i)
else{if(a=$(this),i=parseInt(a.attr("index"),10),a.hasClass("c"))return
$(".season_list_nav .c").removeClass("c"),a.addClass("c")}Swipe.scrollToElement(a,!0)
var o="http://m.tv.sohu.com/videolist?playlistid="+a.attr("sid")+"&callback=seasonVolsListCallback"
Util.loadScript(o)},seasonVolsListCallback:function(e){var t=e&&e.videos
if(t){for(var a,i,o,n,r=[],s=0,l=t.length;l>s;s++)a=t[s],n=a.vid,i=(a.subName||a.name||"").replace(/^[0-9]{8}\s*/,"").replace(e.albumName,"").replace(/第.+?[季部]/,"").replace(TvSetList.seasonName,""),o="/v"+n+".shtml?channeled=1211010200",r.push("<dd>",'<a href="'+o+'" class="cover" vid="'+n+'" channeled="1211010200"><b style="background-image:url('+a.largePicUrl+')"></b></a>','<p><a href="'+o+'" vid="'+n+'" channeled="1211010200">'+i+"</a></p>","</dd>")
r.length>0&&($(".season_list_vol_wrap").html(r.join("")).attr("startX",0).css({webkitTransform:"translate3d(0,0,0)",webkitTransitionDuration:"200ms"}),$(".season_list .scroll_wrap").removeClass("blank_list loading"))}},recommandListCallback:function(e){var t=e.responseData,a=t&&t.data&&t.data.videos,i="loading",o=$(".recommand_list")
if(a){for(var n,r,s,l,c,d=0,p=a.length,u=[];p>d;d++)n=a[d],c=n.vid||n.id,r=WebRoot+"/v"+c+".shtml?channeled=1211010300",s=IsIPad&&PixelRatio>1?n.ver_high_pic:n.ver_big_pic||n.video_big_pic,l=n.tv_play_count,u.push("<dd>",'<a href="'+r+'" class="cover" vid="'+c+'" channeled="1211010300"><b style="background-image:url('+s+')"></b></a>','<p><a href="'+r+'" vid="'+c+'" channeled="1211010300">'+n.tv_name+"</a>"+(l>0?"<span>播放: "+Util.shortCount(l)+"</span>":"")+"</p>","</dd>")
if(u.length>0){i+=" blank_list"
var h=$(".item_list",o).html(u.join(""))
IS_EXTERNAL_PLAYER&&$("a",h).on("click",function(){return WIN.open($(this).attr("href").replace("player=1","")),!1})}}o.removeClass(i)}}
WIN.seasonListCallback=TvSetList.seasonListCallback,WIN.seasonVolsListCallback=TvSetList.seasonVolsListCallback,ENABLE_DEBUG&&(WIN.zongyiPageListCallback=TvSetList.zongyiPageListCallback,WIN.zongyiVideoListCallback=TvSetList.zongyiVideoListCallback),TvSetList.init()
var videoData,FormForceOpen=!1,Comment={contentLengthOverflow:!1,currentPage:1,commentCount:0,editTimer:null,pageSize:5,inited:!1,init:function(){if(!0===Comment.inited)return!0
var e=$("#comments_list")
return e.length<1?!1:(Comment.inited=!0,Comment.elCommentsList=e,Comment.elCommentsWrap=$("#comments_wrap").addClass("blank_list"),Comment.elLoadMore=$(".more",Comment.elCommentsWrap),$(".more",Comment.elCommentsWrap).on("click",Comment.loadMore),Comment.elForm=$("#post_comment_form").on("submit",Comment.postComment),Comment.elSubmit=$("button",Comment.elForm),Comment.elTextLength=$(".input_count",Comment.elForm),Comment.elContent=$("textarea",Comment.elForm).on({focus:function(){FormForceOpen=!1,Comment.elForm.removeClass("closed"),Comment.editTimer=setInterval(Comment.checkInputLength,200)},blur:function(){setTimeout(Comment.onInputBlur,0)}}),"undefined"==typeof PassportSC&&Util.loadScript("http://tv.sohu.com/upload/jq_plugin/passport.js",Comment.onPassportLoaded),!0)},loadComment:function(e){!0===Comment.init()&&(videoData=e,Comment.refresh())},onInputBlur:function(){!0!==FormForceOpen&&(Comment.editTimer&&(clearInterval(Comment.editTimer),Comment.editTimer=null),IsTouch&&!IsAndroid&&setTimeout(function(){Comment.elForm.addClass("closed")},0))},checkInputLength:function(){var e=Comment.elContent.attr("max_length"),t=Comment.elContent.val().length
Comment.elTextLength.html(t+"/"+e),t>e?!1===Comment.contentLengthOverflow&&(Comment.elTextLength.addClass("overflow"),Comment.contentLengthOverflow=!0):!0===Comment.contentLengthOverflow&&(Comment.elTextLength.removeClass("overflow"),Comment.contentLengthOverflow=!1)},onPassportLoaded:function(){var e=PassportSC.cookieHandle()
e&&("0"==PassportSC.cookie.trust?$(".text_wrap .login_tip",Comment.elForm).html('您的账号未激活 <a href="http://my.tv.sohu.com/user/" target="_blank">激活账号</a>'):Comment.elForm.removeClass("not_login"))},postComment:function(e){if(Comment.elTextLength.hasClass("overflow"))Comment.elContent.trigger("focus").addClass("error"),FormForceOpen=!0
else if(Comment.elContent.removeClass("error"),!Comment.elSubmit.hasClass("loading")&&!Comment.elForm.hasClass("post_success")&&!Comment.elForm.hasClass("not_login"))if(""===Comment.elContent.val().trim())Comment.elContent.trigger("focus"),FormForceOpen=!0
else{var t=$("#comment_target"),a="comment_target"
t.length<1&&(t=$('<iframe name="'+a+'" id="'+a+'" frameborder="0"></iframe>'),$(DOC.body).append(t),Comment.elForm.attr("target",a),Comment.elForm.attr("action","http://my.tv.sohu.com/reply/save.do?redirect=blank")),Comment.elForm.trigger("submit"),Util.setLoad(Comment.elSubmit.addClass("loading")),setTimeout(Comment.postCommentLoaded,500)}return e.preventDefault(),!1},postCommentLoaded:function(){Comment.elSubmit.removeClass("loading"),Comment.elForm.addClass("post_success")
var e=$(Comment.getCommentItemHTML({authorimg:"http://tv.sohu.com/upload/space/skin/imgs/avatar_s.jpg",reply_from_user:"http://my.tv.sohu.com/user/",author:decodeURIComponent(PassportSC.cookie.uniqname||"搜狐网友"),content:Comment.elContent.val().trim(),time:+new Date}))
Comment.elCommentsList.prepend(e),Comment.elContent.val(""),setTimeout(function(){Comment.elForm.removeClass("post_success")},3e3)},refresh:function(){Comment.isResfresh=!0,Comment.load(1)},loadMore:function(){Comment.isResfresh=!1,Comment.load(Comment.currentPage+1)},load:function(e){if(!Comment.elLoadMore.hasClass("loading")){Comment.elCommentsWrap.addClass("loading"),Comment.elLoadMore.addClass("loading")
var t=Comment.getCommentUrl(e)
t&&Util.loadScript(t,Comment.onCommentsLoaded)}},onCommentsLoaded:function(){var e=WIN.returnComments,t=e.commentList||[],a=t.length||0
if(Comment.elCommentsWrap.removeClass("loading"),Comment.elLoadMore.removeClass("loading"),a){!1===Comment.isResfresh?Comment.currentPage++:(Comment.currentPage=1,Comment.commentCount=0,Comment.elCommentsList.html(""))
for(var i=[],o=0;a>o;o++)i.push(Comment.getCommentItemHTML(t[o]))
var n=DOC.createElement("div")
n.style.display="none",n.innerHTML=i.join("")
var r,s,a=n.children.length
for(o=a;o--;)r=n.children[o],s=r.id,s&&$("#"+s,Comment.elCommentsList).length>0?(a--,n.removeChild(r)):"DD"==r.nodeName&&Comment.commentCount++
a>0&&(n.style.display="block",Comment.elCommentsList.append(n))
var l=$(".comment_count",Comment.elCommentsWrap),c=e.allCount
$("b",l).html(c),l.attr("class","comment_count comment_count_"+c),Comment.elCommentsWrap.toggleClass("has_more",c>Comment.currentPage*Comment.pageSize),Comment.elCommentsWrap.toggleClass("blank_list",Comment.commentCount<1)}},getCommentUrl:function(e){var t=videoData.cid,a=videoData.vid||0,i=videoData.plid||videoData.sid
if(!t||9001==t||0==t)return""
var o="http://access.tv.sohu.com/reply/list/"+t+"_"+i+"_"+a+"_"+(e-1)*Comment.pageSize+"_"+Comment.pageSize+".js?"+ +new Date
return o},getCommentItemHTML:function(e){var t=e.reply_from_name&&e.reply_from_url.indexOf("my.tv.sohu.com/user")<0,a=['<dd id="comment-'+e.id+'">','<em style="background-image:url('+(e.user_small_photo||e.authorimg||"http://tv.sohu.com/upload/space/skin/imgs/avatar_s.jpg")+')"></em>',"<div>",'<a class="u" '+(t?'style="background-image:url('+e.reply_from_icon+')"':"about:blank")+">"+unescape(e.author)+"</a>",'<div class="content">'+unescape(e.content)+"</div>",'<p class="f">',"<time>"+Util.timeFromNow(e.time)+"</time>",t?' 来自: <a href="'+e.reply_from_url+'" target="_blank">'+unescape(e.reply_from_name)+"</a>":"","</p>","</div>","</dd>"]
return a.join("")}},Swipe={startX:0,startPoint:[0,0],lastX:0,page:1,pageCount:1,scrollerWidth:0,windowWidth:0,initiated:!1,events:{onTouchStart:START_EVENT,onTouchMove:MOVE_EVENT,onTouchEnd:END_EVENT},init:function(){Swipe.initScroller(),$(DOC).on(Swipe.events.onTouchEnd,Swipe.onTouchEnd).on(Swipe.events.onTouchMove,Swipe.onTouchMove).on("touchcancel",Swipe.onTouchCancel).on("click",Swipe.onTouchCancel)},initScroller:function(e){e=e||DOC,$(".scroll_wrap",e).css({webkitBackfaceVisibility:"hidden",overflowX:"hidden",webkitTransform:"translate3d(0,0,0)"}),$(".scroller",e).css({webkitBackfaceVisibility:"hidden",webkitTransform:"translate3d(0,0,0)",webkitTransition:"-webkit-transform 0"}).on(Swipe.events.onTouchStart,Swipe.onTouchStart)},scrollToElement:function(e,t,a){var i=e.parent()
if(0!=i.length){var o=i.get(0)
paddingLeft=o.offsetLeft,paddingRight=o.offsetLeft,toX=-(e.offset().left-paddingLeft),lastCell=o.lastElementChild,scrollerWidth=lastCell.offsetLeft+lastCell.offsetWidth+paddingLeft+paddingRight,windowWidth=i.parent().width(),maxX=scrollerWidth-windowWidth
{parseInt(i.attr("startX")||0)}windowWidth>-toX&&-toX+e.width()<windowWidth&&!a||(-maxX>toX&&(toX=-maxX),toX>0&&(toX=0),i.attr("startX",toX).css({webkitTransform:"translate3d("+toX+"px,0,0)",webkitTransitionDuration:t?"200ms":0}))}},onTouchStart:function(e){var t=this,a=$(this),i=t.childElementCount
if(i>0){Swipe.scrollerWidth=0,Swipe.leftPadding=t.offsetLeft,Swipe.rightPadding=t.offsetLeft
var o=t.lastElementChild
if(o&&(Swipe.scrollerWidth=o.offsetLeft+o.offsetWidth+Swipe.leftPadding+Swipe.rightPadding),Swipe.scrollerWidth<=t.parentNode.offsetWidth)return
Swipe.touchElement=a,Swipe.initiated=!0,a.css("webkitTransitionDuration","0"),Swipe.startX=parseInt(a.attr("startX")||0,10),Swipe.paginationElLeft=null,Swipe.paginationElRight=null,Swipe.windowWidth=a.parent().width()
var n=t.firstElementChild
do{var r=$(n).get(0).offsetLeft
if(!Swipe.paginationElLeft&&r+Swipe.startX>=0&&(Swipe.paginationElLeft=n),r+n.offsetWidth+Swipe.startX>Swipe.windowWidth){Swipe.paginationElRight=n
break}}while(n=n.nextElementSibling)
Swipe.deltaXInsetBound=0
var s=e.originalEvent
Swipe.startPoint=[s.clientX,s.clientY]}},onTouchMove:function(e){if(!1!==Swipe.initiated){var t=e.originalEvent,a=t.clientX-Swipe.startPoint[0],i=t.clientY-Swipe.startPoint[1]
if(a>0&&Swipe.startX>=0?Swipe.lastX=Swipe.startX+a/2:0>a&&-Swipe.startX-a>=Swipe.scrollerWidth-Swipe.windowWidth?Swipe.lastX=-(Swipe.scrollerWidth-Swipe.windowWidth)+(a-Swipe.deltaXInsetBound)/2:(Swipe.lastX=Swipe.startX+a,Swipe.deltaXInsetBound=a),!Swipe.isSwiping&&Math.abs(i)>Math.abs(a))return Swipe.initiated=!1,void 0
e.preventDefault(),Swipe.isSwiping=!0,Swipe.setPos(Swipe.lastX)}},onTouchEnd:function(e){if(Swipe.isSwiping){var t=0,a=Swipe.touchElement.attr("page")||1
if(Swipe.lastX<Swipe.startX){Swipe.paginationElRight?(t=-1*Swipe.paginationElRight.offsetLeft,a++):t=-1*Swipe.paginationElLeft.offsetLeft
var i=Swipe.scrollerWidth-Swipe.windowWidth;-i>t&&(t=-i)}else if(Swipe.lastX>Swipe.startX&&Swipe.paginationElLeft){var o=Swipe.paginationElLeft,n=Swipe.windowWidth-o.offsetWidth-o.offsetLeft
do if(t=-1*o.offsetLeft,t>n){a--
break}while(o=o.previousElementSibling)}Swipe.touchElement.attr("page",a),t>0&&(t=0),Swipe.touchElement.attr("startX",t),Swipe.touchElement.css("webkitTransitionDuration","200ms"),Swipe.setPos(t),e.preventDefault(),Swipe.onTouchCancel()}},onTouchCancel:function(){Swipe.isSwiping=!1,Swipe.initiated=!1,Swipe.touchElement=null},setPos:function(e){Swipe.touchElement.css("webkitTransform","translate3d("+e+"px,0,0)")}}
$().ready(function(){Swipe.init(),$(".scroller").on("webkitTransitionEnd",function(){var e=$(this).attr("page")||1,t=$(".scroller_page b",this.parentNode)
t.removeClass("c"),t.eq(e-1).addClass("c")}),$(WIN).on("resize",function(){$(".scroller").each(function(e){var t=e.getAttribute("page")||1
Swipe.scrollToElement($(e).children().eq(t-1))})})}),IsTouch||RR.addEvent("mousedown",DOC,function(e){for(var e=new RR.event(e),t=e.target;t;){if(nodeName=t.nodeName,"A"==nodeName||"IMG"==nodeName){e.preventDefault()
break}t=t.parentNode}},!1)
var Share={init:function(){var e=$(".share_buttons a").each(Share.shareLink).on("click",function(){Share.closeShareMenu(null,!0)})
e.length>0&&($(".share_handle").on("click",Share.toggleShareMenu),$(DOC).on("click",Share.closeShareMenu))},toggleShareMenu:function(){$(DOC.body).toggleClass("share_open")},closeShareMenu:function(e,t){for(var a=e&&e.target;!t&&DOC!==a&&DOC.body!==a;){if($(a).hasClass("share_buttons share_handle"))return
a=a.parentNode}$(DOC.body).removeClass("share_open")},shareLink:function(e){var t,a=$("em",e),i=a.attr("class"),o=encodeURIComponent(location.href),n=encodeURIComponent(DOC.title),r=WIN.VideoData,s=$('link[rel="apple-touch-icon-precomposed"]').get(0),l=r&&r.video_share_cover||s&&s.href||"",c=encodeURIComponent($('meta[name="description"]').attr("content")||"")
"weibo"==i?t="http://service.weibo.com/share/share.php?url="+o+"&appkey=1753462873&title="+n+"&pic="+l+"&ralateUid=2230913455&searchPic=false":"renren"==i?t="http://widget.renren.com/dialog/share?resourceUrl="+o+"&srcUrl="+o+"&pic="+l+"&description="+c+"&title="+n:"qzone"==i&&(t="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+o+"&site=搜狐视频&pics="+l+"&summary="+c+"&title="+n),e.href=t,e.target="_blank"}}
$().ready(Share.init)
var isMarathonOnline=!0,SohuGlobal={lastPageOffset:0,toggleNavShadow:function(){var e=Util.getPageOffset()
SohuGlobal.lastPageOffset!==e&&($(DOC.body).toggleClass("nav_shadow",e>0),SohuGlobal.lastPageOffset=e)}}
$().ready(function(){var e="ipad"
IsAndroid||IsBlackBerry?e="android":IsIPhone?e="iphone":IsWindowsPhone&&(e="windows_phone")
var t;(t=UA.match(/Android[\s\/]([0-9\._]+)/i))&&!IsQQBrowser&&(t=Util.getVersionNumber(t[1]),2.4>t&&(e+=" fixed_nav")),UA.indexOf("PlayStation")>-1&&(e+=" fixed_nav"),URL.getQueryString("ua")&&Console.log(UA)
var a;(a=UA.match(/MQQBrowser(?:\/([0-9\._]+))?/i))?e+=" qq_browser":IsUC?e+=" uc_browser":UA.match(/ MI 2 /i)?e+=" mi_2":UA.match(/ (HTC|Desire) /i)&&(e+=" htc"),IS_EXTERNAL_PLAYER&&(e+=" all_player")
var i=$(DOC.body).addClass(e)
if(!IS_EXTERNAL_PLAYER){if(setTimeout(SohuGlobal.toggleNavShadow,0),+RR.addEvent("scroll",WIN,SohuGlobal.toggleNavShadow),!URL.getQueryString("clientType")){var o=1==URL.getQueryString("isappinstalled")?"打开应用":IsAndroid?"":"立即下载",n=Storage("app_banner"),r=+new Date-parseInt(n,10)
r>2592e5&&(n=null)
var s=Util.getDownloadAppLink()
if(isMarathonOnline&&$(".home").length>0||!n){var l=$(".body_wrap")
if(l.length>0){var c=Math.random(),d=0;.5>=c&&(d=1),d=isMarathonOnline&&$(".home").length>0?0:1
var p=['<a class="app_download app_download_marathon" position="appdownload_banner_marathon" href="http://m.tv.sohu.com/mb/avt/"><span></span></a>','<a class="app_download app_download_2" position="appdownload_banner_2" href="'+s+'"><b>'+o+"</b><span></span><em></em></a>"],u=p[d],h=$(u).on("click",Util.appLink),m=$(".player_column",l)
m.length>0&&(l=m)
var v=$("nav")
v.length>0&&$(".player_column").length<1?v.after(h):l.prepend(h),elClose=$("em",h).on("click",function(){return h.remove(),Storage("app_banner",+new Date),!1})}}var f=WIN.VideoData
if(f){var g
$(".channel_link").on("click",function(){var e=$(this)
return ClickTrace.pingback(null,"link_channel"),setTimeout(function(){location.href=e.attr("href")},50),!1}),$('<span class="app_download_link" position="appdownload_belowplayer"><b></b>下载</span>').prependTo($(".appbar")).on("click",Util.appLink)
var _=Storage("app_ver"),y=APP_VER[IsIOS?"ios":"android"],C=y.version
if(_!==C){var b=$('<div class="app_notice_bar"><span class="close">我已安装</span><span class="app_download_link" position="appdownload_hd_video">安装客户端，体验高清视频</span></div>').insertBefore($(".season_list"))
$(".app_download_link",b).on("click",Util.appLink),$(".close",b).on("click",function(){Storage("app_ver",C),b.remove(),g&&g.removeClass("show"),ClickTrace.pingback(null,"tip_installed")})}var n=Storage("app_pinner"),r=+new Date-parseInt(n,10)
if("0"===n?n=!0:r>864e5&&(n=null),_!==C&&!n){var T='<div class="voice_pinner"'+(IsAndroid?' href="http://upgrade.m.tv.sohu.com/channels/hdv/824/1.0/WebVideo_v1.0_824_201311271605.apk?t=1"':"")+' position="appdownload_floatdiv"><b>搜狐视频V'+C+"版本上线</b>"+y.tip+"<em></em></div>"
isMarathonOnline&&(T='<div class="voice_pinner" href="http://m.tv.sohu.com/mb/avt/" position="marathon_floatdiv" style="line-height:1.6">与搜狐视频一起看大片<br />赢5S大奖!<em></em></div>'),g=$(T).appendTo(DOC.body).on("click",function(){isMarathonOnline||Storage("app_ver",C),Util.appLink.apply(this),g.removeClass("show")}),$("em",g).on("click",function(){return g.removeClass("show"),isMarathonOnline||Storage("app_pinner",+new Date),!1}),WIN.onload=function(){i.hasClass("bookmark_show_tip bookmark_show_handle uc_bookmark_show bookmark")||(g.addClass("show"),ClickTrace.pingback(null,"tip_appupdate"))}}}}setTimeout(function(){Util.getPageOffset()<1&&WIN.scrollTo(0,0)},0)
var w=$(".channel_nav .c")
w.length>0&&(Swipe.scrollToElement(w),setTimeout(function(){Swipe.scrollToElement(w)},100),setTimeout(function(){Swipe.scrollToElement(w)},500)),$(".channel_nav a").on("click",function(){var e=$(this),t="index_nav_"+e.attr("position")
return ClickTrace.pingback(null,t),setTimeout(function(){location.href=e.attr("href")},10),!1})}})
var VideoData=WIN.VideoData,Body,Bookmark={init:function(){IS_EXTERNAL_PLAYER||(Body=$(DOC.body),IsUC&&IsAndroid&&Bookmark.uc())},getBookmarkState:function(){var e=Storage("bookmark_tip"),t=+new Date-parseInt(e,10)
return e?t>1296e6?2:1:0},showBottomBookmarkTip:function(){var e=Bookmark.getBookmarkState(),t="bookmark_show_handle"
if(1===e)t+=" bookmark_show_icon"
else{if(2==e)return
ClickTrace.pingback(null,"tip_bookmark_show")}var a={iphone:["书签图标","添加到主屏幕",""],"default":["菜单","添加书签",""],360:["菜单","加入收藏",""],baidu:["书签图标","添加书签","left_top"],oupeng:["书签图标","收藏到首页","left_top oupeng"],mi:["书签图标","发送桌面","left_top"],sogou:["菜单","添加收藏","right_bottom"]},i=a["default"]
UA.match(/baidubrowser/i)?i=a.baidu:UA.match(/360browser/i)?i=a["360"]:UA.match(/SogouMSE/i)?i=a.sogou:UA.match(/Oupeng/i)?i=a.oupeng:UA.match(/MiuiBrowser/i)?i=a.mi:IsIPhone&&(i=a.iphone)
{var o=['<div class="bookmark_frame '+i[2]+'">','<span class="bookmark_handle button">收藏搜狐视频</span>','<div class="bookmark_tip">','<p class="text">点击浏览器'+i[0]+"，选择“"+i[1]+"”</p>",'<a class="button button_close">知道了</a>',"</div>","</div>"]
$(o.join("")).on("click",Bookmark.showBookmarkIntro).appendTo(Body)}setTimeout(function(){Body.addClass(t)},0)},showBookmarkIntro:function(e){if(Body.hasClass("bookmark_show_tip")){var t=$(e.target)
if(t.hasClass("button_close")){Body.removeClass("bookmark_show_tip").addClass("bookmark_show_handle bookmark_show_icon")
var a=Bookmark.getBookmarkState()
1!==a&&(Storage("bookmark_tip",+new Date),ClickTrace.pingback(null,"tip_bookmark_click"))}}else Body.removeClass("bookmark_show_icon").addClass("bookmark_show_tip")},uc:function(){if(Body.hasClass("home")||VideoData){var e=0
if((e=UA.match(/UCBrowser[\s\/]([0-9\._]+)/i))&&(e=Util.getVersionNumber(e[1])),e>=9){var t=Storage("ucmark")||0,a=+new Date-parseInt(t,10)
if(a>2592e6){var i,o="http://app.uc.cn/appstore/AppCenter/frame?uc_param_str=nieidnutssvebipfcp&api_ver=2.0&id=513",n=($('<div class="uc_bookmark_frame" ><iframe frameborder="0" src="'+o+'"></iframe></div>').appendTo(DOC.body),function(){Body.addClass("bookmark"),i?Body.addClass("uc_bookmark_show"):(i=$('<div class="uc_bookmark_handle"><em class="close"></em><span class="button">添加</span>添加<b>搜狐视频</b>到你的浏览器首页，访问更方便</div>').on("click",function(){Body.addClass("uc_bookmark_show")}).appendTo(DOC.body),$(".close",i).on("click",function(){return i.remove(),Storage("ucmark",+new Date),!1}))})
RR.addEvent("message",WIN,function(e){var t=e.data
if(t){var a=t.message,o=t.type
if("not exist"==a||""==a){if($(".voice_pinner").hasClass("show"))return
n(),ClickTrace.pingback(null,"tip_uc_nav_show")}else("close"==a||"cancle"==a||"success"==a)&&(Body.removeClass("bookmark_show uc_bookmark_show"),"1"==o&&(i.remove(),Storage("ucmark","0"),ClickTrace.pingback(null,"tip_uc_nav_add")))}})}}}}}
$().ready(Bookmark.init)
var FloatTitleBar={menuWrapCache:{},menuItemCache:{},menuItems:[],floatTitleBar:null,floatTitleHeight:0,topPadding:0,currentHighlightMenuKey:"",init:function(){$(DOC.body).hasClass("fixed_nav")||Util.isMeizu()||$("*[float_menu]").length>0&&(FloatTitleBar.topPadding=48,FloatTitleBar.updateMenuItem(),RR.addEvent("load",WIN,FloatTitleBar.updateMenuItem),RR.addEvent("resize",WIN,FloatTitleBar.updatePosition),RR.addEvent("scroll",WIN,FloatTitleBar.updatePosition),$(DOC).on("touchmove",FloatTitleBar.updatePosition))},updateMenuItem:function(){if(!$(DOC.body).hasClass("fixed_nav")){FloatTitleBar.currentHighlightMenuKey="",FloatTitleBar.floatTitleBar&&FloatTitleBar.floatTitleBar.removeClass("fixed_title"),FloatTitleBar.topPadding=$("nav").height()+2,FloatTitleBar.elTitleBars=$("*[float_menu]"),FloatTitleBar.floatTitleBar=FloatTitleBar.elTitleBars.eq(0)
var e=0
FloatTitleBar.elTitleBars.each(function(t){var a=t.getAttribute("float_menu"),i=t.getAttribute("float_menu_label"),o=$(t),n=$(".k_"+a,FloatTitleBar.floatTitleBar)
if(n.length<1&&(n=$('<b class="k_'+a+'" key="'+a+'">'+i+"</b>").appendTo(FloatTitleBar.floatTitleBar)),n.insertAfter($("b[key]",FloatTitleBar.floatTitleBar).eq(e)),FloatTitleBar.menuItemCache[a]=n.on("click",FloatTitleBar.scrollTo),FloatTitleBar.menuWrapCache[a]=o.parent().parent(),e>0)for(var r,s=$("b[key]",o),l=s.length;l--;)r=s.eq(l),l>0?r.remove():r.removeClass("c")
e++}),FloatTitleBar.floatTitleHeight=FloatTitleBar.floatTitleBar.height(),FloatTitleBar.topPadding+=FloatTitleBar.floatTitleHeight,setTimeout(FloatTitleBar.updatePosition,0)}},updatePosition:function(){var e,t=FloatTitleBar.floatTitleBar,a=t.parent().offset().top,i=Util.getPageOffset(),o=a-i
o<FloatTitleBar.topPadding-FloatTitleBar.floatTitleHeight?t.addClass("fixed_title"):t.removeClass("fixed_title")
for(var n=0,r=FloatTitleBar.elTitleBars.length;r>n;n++){var s=FloatTitleBar.elTitleBars.eq(n),l=s.attr("float_menu"),c=FloatTitleBar.menuWrapCache[l],a=c.offset().top,d=(FloatTitleBar.menuItemCache[l],FloatTitleBar.topPadding),p=WIN.innerHeight,o=a-i,u=a-i+c.height()
if((0===n&&o>=d||o>d&&p/3>o||d>=o&&u>=p/3||n===r-1&&p>=u)&&(e=l,0===n))break}FloatTitleBar.highlightMenuItem(e)},highlightMenuItem:function(e){if(e!==FloatTitleBar.currentHighlightMenuKey){var t,a
for(t in FloatTitleBar.menuItemCache)a=FloatTitleBar.menuItemCache[t],t===e?a.addClass("c"):a.removeClass("c")
FloatTitleBar.currentHighlightMenuKey=e}},scrollTo:function(e,t){var t=$(this).attr("key"),a=FloatTitleBar.menuWrapCache[t]
return a?(DOC.body.scrollTop=a.offset().top-FloatTitleBar.topPadding+FloatTitleBar.floatTitleHeight+2,setTimeout(function(){FloatTitleBar.highlightMenuItem(t)},0),void 0):void 0}}
$().ready(FloatTitleBar.init)
var MainPlayer,videoData=WIN.VideoData,PlayerPage={nidMap:{},channelMap:{1:["电影","movie"],1000:["电影","movie"],2:["电视剧","drama"],7:["综艺","show"],8:["纪录片","documentary"],13:["娱乐","yule"],16:["动漫","comic"],25:["新闻","news"],24:["音乐","music"]},ajaxObj:null,player:null,currentURL:null,currentVid:null,retryCount:0,init:function(){if($(WIN).on("resize",PlayerPage.updateDetailHeight),RR.addTagEvent("click","a",function(){var e=$(this),t=e.attr("vid"),a=e.attr("channeled")
return t?(WIN.scrollTo(0,0),Body.removeClass("search_actived history_open"),PlayerPage.loadVideo(t,a),!1):void 0}),IsHistorySupport&&RR.addEvent("popstate",WIN,PlayerPage.updatePage),videoData){WIN.vid=videoData.vid,WIN.pid=videoData.plid,videoData.video_cover=$('meta[property="og:image"]').attr("content"),videoData.tv_name=$(".player_info h3").html()
var e;(e=location.pathname.match(/(\/[0-9]+\/n[0-9]+|\/us\/[0-9]+\/[0-9]+)\.shtml/i))&&(PlayerPage.nidMap[e[1]]=videoData.vid),$().ready(function(){var e=$(".video_detail .desc").on("click",function(){e.toggleClass("expand")})
PlayerPage.updatePlayerPageByVideoData(videoData)})}},updatePage:function(){if(null===PlayerPage.currentURL)return PlayerPage.currentURL=location.href,void 0
var e,t=$(DOC.body).removeClass("page_home page_channel page_player"),a=location.pathname
if(e=a.match(/\/v([0-9]+)\.shtml/i))PlayerPage.loadVideo(e[1],$().getUrlParam("channeled")),t.addClass("page_player")
else if(e=a.match(/(\/[0-9]+\/n[0-9]+|\/us\/[0-9]+\/[0-9]+)\.shtml/i)){var i=PlayerPage.nidMap[e[1]]
i?(PlayerPage.loadVideo(i,$().getUrlParam("channeled")),t.addClass("page_player")):location.href=location.pathname}else a.match(/\/(\?.*)?$/)?t.addClass("page_home"):t.addClass("page_channel")},showPageGrid:function(){if($(".page_wrap_player").length<1){var e='<div class="page_wrap_player video_channel_0"><div class="player_column item_ver_wrap"><div class="player player_init" id="#main_player"><div class="video"></div><div class="poster"><div class="cover" data-key="video_cover" data-type="image" style="background-image:url(about:blank)"></div><div class="player_info"><h3 data-key="tv_name"></h3><div data-key="tv_summary"></div></div><div class="time"><em></em><span data-key="totalDuration" data-type="time"></span></div></div><div class="player_controls"><div class="button_play"><span><b></b></span></div><div class="message"><p></p></div><div class="slider_bar"><div class="trackbar"><b class="buffered"></b><b class="played"><em class="handle"></em><em class="dragbar"><em class="drag_timer"></em></em></b></div><div class="time"><em></em><b class="current_time">00:00</b> / <span class="duration" data-key="totalDuration" data-type="time"></span></div><div class="controllers"><div class="fullscreen disabled"><span><b></b></span></div></div></div></div></div></div></div>'
$(".body_wrap").append(e)}$(DOC.body).removeClass("page_channel home").addClass("page_player"),SohuGlobal.toggleNavShadow()},loadVideo:function(e,t){if(e!=videoData.vid){var a=$().extend({},URL.URLGlobalParms)
t&&(a.channeled=t)
var i=URL.objToQueryString(a),o=location.origin+"/v"+e+".shtml"+(i?"?"+i:"")
if(!IsIOS||!IsHistorySupport)return location.href=o,void 0
PlayerPage.currentVid=e
var a=$().extend({playurls:"1"},API_PARAMS)
PlayerPage.retryCount=0
var n="/api/video/info/"+e+".json?"+$().param(a)
if(PlayerPage.ajaxObj||(PlayerPage.ajaxObj=new ajaxObj("",{beforeSend:PlayerPage.beforeLoadVideo,always:PlayerPage.loadVideoCallback})),PlayerPage.ajaxObj.get(n),o!==location.href){var r,s
if((r=location.pathname.match(/(\/[0-9]+\/n[0-9]+|\/us\/[0-9]+\/[0-9]+)\.shtml/i))&&(s=PlayerPage.nidMap[r[1]],s==e))return
history.pushState(null,null,o)}}},beforeLoadVideo:function(){$(DOC.body).addClass("page_player_loading"),MainPlayer.pause()},loadVideoCallback:function(e){var t=e.responseData,a=t&&t.data
if(!a||!a.tv_name){if(PlayerPage.retryCount>1)return $(DOC.body).removeClass("page_player_loading"),location.href="v"+PlayerPage.currentVid+".shtml",void 0
var i=$().extend({c:"9001"},API_PARAMS),o="/api/video/playinfo/"+PlayerPage.currentVid+".json?"+$().param(i)
return PlayerPage.ajaxObj.get(o),PlayerPage.retryCount++,void 0}$(DOC.body).removeClass("page_player_loading")
var n="|"+a.cid+"|"
a.tv_desc=a.tv_desc||a.tv_name,a.tv_detail=PlayerPage.getVideoDetail(a),a.tv_summary=PlayerPage.getVideoSummary(a),a.video_cover=a.ver_high_pic||a["|2|8|16|".indexOf(n)>-1?"ver_big_pic":"video_big_pic"]
var r=a.tv_name
r=r+(r?" - ":"")+"搜狐视频手机版",DOC.title=r,$('*[data-type="highlight"]').removeClass("c"),$("*[data-key]").each(function(e){var t=$(e),i=t.attr("data-key"),o=t.attr("data-type"),n=a[i]||""
"image"==o?t.css("backgroundImage","url("+(n||"about:blank")+")"):"highlight"==o?t.attr("data-value")==n&&t.addClass("c"):"attr"==o?t.attr(t.attr("data-value"),n):("time"==o&&(n=Util.secondsToTime(n)),t.html(n))}),videoData=WIN.VideoData={vid:a.vid||PlayerPage.currentVid,cid:a.cid||"9001",sid:a.sid||a.vid,plid:a.play_list_id||a.vid,video_cover:a.video_cover,video_share_cover:a.video_big_pic,videoCount:a.vcount,tv_name:a.tv_name,ipLimit:a.ipLimit||"0",urls:{m3u8:[a.url_nor||"",a.url_high||"",a.url_super||""],mp4:[a.url_nor_mp4||"",a.url_high_mp4||""],downloadUrl:Util.getDownloadURL(a.downloadurl)||""},duration:a.totalDuration,apiData:a},PlayerPage.updatePlayerPageByVideoData(videoData)},showTips:function(){var e=$("#main_player").addClass("forbidden"),t=$(".player_message")
t.length<1&&$('<span class="player_message">您所在的国家或地区, 不在所播放的节目版权范围</span>').insertAfter(e)},ipCallback:function(e){var t=e.responseData||{}
t.data&&"1"==t.data.iplimit?PlayerPage.showTips():($("#main_player").removeClass("forbidden"),PlayerPage.updatePlayerPageByVideoData(videoData,!0))},updatePlayerPageByVideoData:function(e,t){var a=!0
if(!t)if("1"==e.h5Limit)PlayerPage.showTips(),a=!1
else if("1"==e.ipLimit){var i=$().extend({from:"h5",poid:"1",sysver:Util.getOSVersion()||"0"},API_PARAMS)
return $().get("/api/mobile_user/device/clientconf.json?"+$().param(i),{always:PlayerPage.ipCallback,timeout:5}),void 0}MainPlayer||(MainPlayer=new Player("#main_player")),!0===a&&(MainPlayer.currentTime(0),MainPlayer.loadVideoByData(e,0))
var o=e.cid+""
if(!IS_EXTERNAL_PLAYER){var n=$(".score")
if(n.length>0&&e)if(o.match(/^(2|1000|16|7|8)$/)){var r=(n.attr("num")+"").replace(/^([0-9]+)\.([0-9]).*/,"<b>$1</b>.$2分")
n.html(r).css("display","block")}else n.css("display","none")
Comment.loadComment(e),PlayerPage.updateDetailHeight(),$(".share_buttons a").each(Share.shareLink)
var s=PlayerPage.channelMap[o]
s?$(".channel_link").attr("href",location.origin+"/"+s[1]).attr("class","channel_link channel_link_"+o).html(s[0]+"频道"):$(".channel_link").attr("href",location.origin).attr("class","channel_link").html("更多精彩视频")
var l=PlayHistory.checkIsVideoAddedToWatchLater(e)
$(".watch_later_icon").toggleClass("watch_later_icon_done",l)}setTimeout(function(){TvSetList.loadByVideoData(e)},50)},updateDetailHeight:function(){var e=$(".video_detail .desc")
e.toggleClass("has_more",$("span",e).height()>110)},getVideoSummary:function(e){{var t,a=[],i="|"+e.cid+"|",o=e.vcount
e.totalSet}return"|2|16|".indexOf(i)>-1&&a.push("<p>更新至"+o+"集</p>"),"|8|".indexOf(i)>-1&&a.push("<p>更新至"+o+"期</p>"),"|7|".indexOf(i)>-1&&(t=e.tvGuest,t&&a.push("<p>嘉宾: "+t.replace(/;/g," ")+"</p>"),t=e.tvPresenter,t&&a.push("<p>主持人: "+t.replace(/;/g," ")+"</p>")),"|1|".indexOf(i)>-1&&(t=e.director,t&&a.push("<p>导演: "+t.replace(/;/g," ")+"</p>")),"||0|13|24|".indexOf(i)>-1&&(t=e.update_time,t&&a.push("<p>"+Util.dateString(t)+"</p>")),"|1|2|".indexOf(i)>-1&&(t=e.main_actor,t&&a.push("<p>主演: "+t.replace(/;/g," ")+"</p>")),"|16|".indexOf(i)>-1&&(t=e.tv_year,t&&a.push("<p>年份: "+t+"</p>")),"|7|".indexOf(i)>-1&&(t=e.area,t&&a.push("<p>地区: "+t.replace(/;/g," ")+"</p>")),"|8|".indexOf(i)>-1&&(t=e.tv_cont_cats,t&&a.push("<p>类型: "+t.replace(/;/g," ")+"</p>")),a.join("")},getVideoDetail:function(e){var t,a=[],i="|"+e.cid+"|",o=e.vcount,n=e.totalSet
if("|2|16|7|8|".indexOf(i)>-1){if(a.push("<label>"+("|7|"==i?"期":"集")+"数:</label>"),a.push("<p>"),"|7|"==i)a.push("更新至"+o+"期")
else{var r="|8|"==i?"期":"集"
o!=n?a.push("第"+o+r+"<span> · 共"+n+r+"</span>"):a.push("共"+n+r)}a.push("</p>")}return"|1|2|8|16|24|33|".indexOf(i)>-1&&(t=e.tv_year,t&&(a.push("<label>年份:</label>"),a.push("<p>"+t+"</p>"))),"||0|13|25|".indexOf(i)>-1&&(t=e.update_time,t&&(a.push("<label>时间:</label>"),a.push("<p>"+Util.dateString(t)+"</p>"))),t=e.tv_cont_cats,t&&(a.push("<label>类型:</label>"),a.push("<p>"+t.replace(/;/g," ")+"</p>")),"|7|8|".indexOf(i)>-1&&(t=e.area,t&&(a.push("<label>地区:</label>"),a.push("<p>"+t.replace(/;/g," ")+"</p>"))),t=e.director,t&&(a.push("<label>导演:</label>"),a.push("<p>"+t.replace(/;/g," ")+"</p>")),t=e.main_actor,t&&(a.push("<label>主演:</label>"),a.push("<p>"+t.replace(/;/g," ")+"</p>")),a.join("")}}
PlayerPage.init()
var videoData=WIN.VideoData,RateTest={mode:"man",apiURL:"",hotURL:"",disURLQueue:[],videoTsCount:0,urlTimeoutTimers:{},urlTimeoutURLs:{},id:0,init:function(){null!==URL.getQueryString("r")&&videoData&&($(".body_wrap").prepend('<div class="rate_test"><span class="button">速度测试</span><span class="tip">UID: '+(Cookie.get("SUV")||"-")+"</span><div></div></div>"),$(".rate_test .button").on("click",function(){var e=$(this),t="disabled"
e.hasClass(t)||(e.addClass(t),RateTest.startTest("man"))}))},startTest:function(e){RateTest.mode=e,$(".rate_test div").html(""),RateTest.addTitle("OpenAPI"),RateTest.apiURL="http://api.tv.sohu.com/video/playinfo/"+videoData.vid+".json?api_key=9854b2afa779e1a6bff1962447a09dbd&plat=6&sver=2.8&partner=999&c=1&sid=0",RateTest.addURLItem(RateTest.apiURL)
for(var t,a=RateTest.id++,i=videoData.urls.m3u8,o=new Date,n=0,r=i.length;r>n;n++)if(i[n]){t=i[n]
break}t&&(RateTest.hotURL=t,RateTest.addTitle("Hot VRS"),$(".rate_test div").append(RateTest.getItemHTML(a,t)),t.match(/\.m3u8/i)&&(t=t.replace(/http:\/\/[^\/]+/i,"/hot_vrs")),$().ajax(t,{dataType:"html",always:function(e){var t=e.responseText
if(t){var i,n,r=t.match(/(http:\/\/[^\s]+)/gi)||[],s=0,l=r.length
if(RateTest.videoTsCount=l,l>0){RateTest.URLLoaded(a,o,RateTest.hotURL),RateTest.addTitle("m3u8 ("+l+")","rate_test_video")
for(var s=0,l=r.length;l>s;s++)n="m3u8callback_"+s,i=r[s].replace(/http:\/\/[^\/]+/i,"http://61.135.183.62")+"&prot=2&callback="+n+"&id="+RateTest.id++,WIN[n]=function(e){var t=e.url,a=this.url,i=(a.match(/&id=([0-9]+)/i)||[])[1]
if(t){var o=new Date,n=RateTest.addURLItem(t,i,RateTest.requestNextDisURL)
RateTest.urlTimeoutTimers[t]=setTimeout(function(){RateTest.URLLoaded(n,o,t,i,null,!0),RateTest.requestNextDisURL()},3e4)}}.bind({url:i}),RateTest.disURLQueue.push(i)
RateTest.addURLItem(RateTest.disURLQueue.shift())}else{var c=$(".rate_test .item_"+a).addClass("error")
$("time",c).html("!")}}}}))},requestNextDisURL:function(){var e=RateTest.disURLQueue.shift(),t="#rate_test_video",a=$(".rate_test .item .loaded").length
e&&RateTest.addURLItem(e,null,null,t),$(t).html("m3u8 ("+a+"/"+RateTest.videoTsCount+")"),a==RateTest.videoTsCount&&$(".rate_test .button").removeClass("disabled")},addURLItem:function(e,t,a,i){var o=(e.match(/&id=([0-9]+)/i)||[])[1]
return o||(o=RateTest.id++),t?$(".rate_test .item_"+t).append(RateTest.getItemHTML(o,e,t)):i?$(i).after(RateTest.getItemHTML(o,e)):$(".rate_test div").append(RateTest.getItemHTML(o,e)),Util.loadScript(e,RateTest.URLLoaded,[o,new Date,e,t,a]),o},getItemHTML:function(e,t){return'<p class="item item_'+e+'"><time>...</time><span>'+t+"</span></p>"},URLLoaded:function(e,t,a,i,o,n){var r=RateTest.urlTimeoutTimers[a]
if(r&&(clearTimeout(r),delete RateTest.urlTimeoutTimers[a]),!(a in RateTest.urlTimeoutURLs)){n&&(RateTest.urlTimeoutURLs[a]=1)
var s=$(".rate_test .item_"+e).addClass(n?"error":"loaded"),l="",c="",d="",p=((new Date-t)/1e3).toFixed(2)
$("time",s).eq(0).html(n?"!":p+" s"),i&&(l=$(".rate_test .item_"+i+" span").html().replace(/&amp;/g,"&")),(c=a.match(/cip=([0-9\.]+)/i))&&(c=c[1],d=a.match(/http:\/\/([^\/]+)/i)[1])
var a="http://sptjs1.hd.sohu.com.cn/h5/tttst.html?mode="+RateTest.mode+"&uid="+(Cookie.get("SUV")||"")+"&api="+encodeURIComponent(RateTest.apiURL)+"&hotvrs="+encodeURIComponent(RateTest.hotURL)+"&disp="+encodeURIComponent(l)+"&url="+encodeURIComponent(a)+"&clientip="+c+"&cdnip="+d+"&speed="+p+(n?"&timeout":"")
Util.pingback(a),o&&o()}},addTitle:function(e,t){$(".rate_test div").append('<p class="title" id="'+t+'">'+e+"</p>")}}
$().ready(RateTest.init)
